<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.5.3" />
<title>area_cm API documentation</title>
<meta name="description" content="" />
<link href='https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css' rel='stylesheet'>
<link href='https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/8.0.0/sanitize.min.css' rel='stylesheet'>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" rel="stylesheet">
<style>.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{font-weight:bold}#index h4 + ul{margin-bottom:.6em}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.name small{font-weight:normal}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase;cursor:pointer}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}.admonition{padding:.1em .5em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title"><code>area_cm</code> module</h1>
</header>
<section id="section-intro">
<details class="source">
<summary>Source code</summary>
<pre><code class="python">from flask import Blueprint, render_template, abort, Flask, redirect, url_for, session, request
from area_db import db
from area_tools import check_token
import requests
import json

CC_KEY = &#34;a54e50605a13b86cfeb42c44e00e0527021b79ad9de24369698419099c0479ba&#34;

def crypto_value_check(user, cm_data):
        &#34;&#34;&#34;
        Description\n
                Check function for CM action : crypto value
        Parameters
                user : user dict\t
                cm_data : cm_data dict
        Return
                True or error message
        &#34;&#34;&#34;
        try:
                symbol = cm_data[&#34;symbol&#34;]
                value_cap = int(cm_data[&#34;value_cap&#34;])
        except:
                return &#34;CryptoService : Missing cryptoccurrency or value cap&#34;
        url = &#34;https://min-api.cryptocompare.com/data/price?fsym=&#34; + symbol + &#34;&amp;tsyms=USD,JPY,EUR&#34;
        headers = {
                &#39;authorization&#39;: &#39;Apikey &#39; + CC_KEY
        }
        response = requests.request(&#34;GET&#34;, url, headers=headers)
        data = response.json()
        try :
                value = data[&#34;EUR&#34;]
        except:
                return &#34;CryptoService : Invalid cryptocurrency&#34;
        if response.status_code != 200:
                return &#34;CryptoService : Invalid cryptocurrency&#34;
        if value_cap &lt; value:
                return &#34;CryptoService : The value cap has already been reached&#34;
        return True

def crypto_value(user, id, reaction, job_id):
        &#34;&#34;&#34;
        Description\n
                Action function for Crypto service : triggers when a chosen cryptocurrency hits a chosen
        Parameters
                user : user dict\t
                id : trigger id
                reaction : reaction function\t
                job_id : id of apscheduler job
        &#34;&#34;&#34;
        symbol = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;symbol&#34;]
        value_cap = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;value_cap&#34;]
        url = &#34;https://min-api.cryptocompare.com/data/price?fsym=&#34; + symbol + &#34;&amp;tsyms=USD,JPY,EUR&#34;
        headers = {
                &#39;authorization&#39;: &#39;Apikey &#39; + CC_KEY
        }
        response = requests.request(&#34;GET&#34;, url, headers=headers)
        data = response.json()
        value = data[&#34;EUR&#34;]
        if value &gt;= int(value_cap):
                reaction(user, id)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="area_cm.crypto_value"><code class="name flex">
<span>def <span class="ident">crypto_value</span></span>(<span>user, id, reaction, job_id)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>Action function for Crypto service : triggers when a chosen cryptocurrency hits a chosen</dd>
<dt><strong><code>Parameters</code></strong></dt>
<dd>user : authenticated user
<br>
id : trigger id
<br>
reaction : reaction function
<br>
job_id : id of apscheduler job</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def crypto_value(user, id, reaction, job_id):
        &#34;&#34;&#34;
        Description\n
                Action function for Crypto service : triggers when a chosen cryptocurrency hits a chosen
        Parameters
                user : user dict\t
                id : trigger id
                reaction : reaction function\t
                job_id : id of apscheduler job
        &#34;&#34;&#34;
        symbol = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;symbol&#34;]
        value_cap = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;value_cap&#34;]
        url = &#34;https://min-api.cryptocompare.com/data/price?fsym=&#34; + symbol + &#34;&amp;tsyms=USD,JPY,EUR&#34;
        headers = {
                &#39;authorization&#39;: &#39;Apikey &#39; + CC_KEY
        }
        response = requests.request(&#34;GET&#34;, url, headers=headers)
        data = response.json()
        value = data[&#34;EUR&#34;]
        if value &gt;= int(value_cap):
                reaction(user, id)</code></pre>
</details>
</dd>
<dt id="area_cm.crypto_value_check"><code class="name flex">
<span>def <span class="ident">crypto_value_check</span></span>(<span>user, cm_data)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>Check function for CM action : crypto value</dd>
<dt><strong><code>Parameters</code></strong></dt>
<dd>user : authenticated user
<br>
cm_data : cm_data dict</dd>
<dt><strong><code>Return</code></strong></dt>
<dd>True or error message</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def crypto_value_check(user, cm_data):
        &#34;&#34;&#34;
        Description\n
                Check function for CM action : crypto value
        Parameters
                user : user dict\t
                cm_data : cm_data dict
        Return
                True or error message
        &#34;&#34;&#34;
        try:
                symbol = cm_data[&#34;symbol&#34;]
                value_cap = int(cm_data[&#34;value_cap&#34;])
        except:
                return &#34;CryptoService : Missing cryptoccurrency or value cap&#34;
        url = &#34;https://min-api.cryptocompare.com/data/price?fsym=&#34; + symbol + &#34;&amp;tsyms=USD,JPY,EUR&#34;
        headers = {
                &#39;authorization&#39;: &#39;Apikey &#39; + CC_KEY
        }
        response = requests.request(&#34;GET&#34;, url, headers=headers)
        data = response.json()
        try :
                value = data[&#34;EUR&#34;]
        except:
                return &#34;CryptoService : Invalid cryptocurrency&#34;
        if response.status_code != 200:
                return &#34;CryptoService : Invalid cryptocurrency&#34;
        if value_cap &lt; value:
                return &#34;CryptoService : The value cap has already been reached&#34;
        return True</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="area_cm.crypto_value" href="#area_cm.crypto_value">crypto_value</a></code></li>
<li><code><a title="area_cm.crypto_value_check" href="#area_cm.crypto_value_check">crypto_value_check</a></code></li>
<li><code><a title="area_yt.yt_new_video" href="#area_yt.yt_new_video">yt_new_video</a></code></li>
<li><code><a title="area_yt.yt_new_video_check" href="#area_yt.yt_new_video_check">yt_new_video_check</a></code></li>
<li><code><a title="area_yt.yt_subscribers_above_channel" href="#area_yt.yt_subscribers_above_channel">yt_subscribers_above_channel</a></code></li>
<li><code><a title="area_yt.yt_subscribers_above_channel_check" href="#area_yt.yt_subscribers_above_channel_check">yt_subscribers_above_channel_check</a></code></li>
<li><code><a title="area_yt.yt_subscribers_record" href="#area_yt.yt_subscribers_record">yt_subscribers_record</a></code></li>
<li><code><a title="area_yt.yt_subscribers_record_check" href="#area_yt.yt_subscribers_record_check">yt_subscribers_record_check</a></code></li>
<li><code><a title="area_wh.weather_alert_cold" href="#area_wh.weather_alert_cold">weather_alert_cold</a></code></li>
<li><code><a title="area_wh.weather_alert_cold_check" href="#area_wh.weather_alert_cold_check">weather_alert_cold_check</a></code></li>
<li><code><a title="area_wh.weather_alert_hot" href="#area_wh.weather_alert_hot">weather_alert_hot</a></code></li>
<li><code><a title="area_wh.weather_alert_hot_check" href="#area_wh.weather_alert_hot_check">weather_alert_hot_check</a></code></li>
<li><code><a title="area_tw.get_friend_followers" href="#area_tw.get_friend_followers">get_friend_followers</a></code></li>
<li><code><a title="area_tw.get_tw_id" href="#area_tw.get_tw_id">get_tw_id</a></code></li>
<li><code><a title="area_tw.tw_post_tweet" href="#area_tw.tw_post_tweet">tw_post_tweet</a></code></li>
<li><code><a title="area_tw.tw_post_tweet_check" href="#area_tw.tw_post_tweet_check">tw_post_tweet_check</a></code></li>
<li><code><a title="area_tw.tw_reach_followers" href="#area_tw.tw_reach_followers">tw_reach_followers</a></code></li>
<li><code><a title="area_tw.tw_reach_followers_check" href="#area_tw.tw_reach_followers_check">tw_reach_followers_check</a></code></li>
<li><code><a title="area_tw.tw_reach_friend_followers" href="#area_tw.tw_reach_friend_followers">tw_reach_friend_followers</a></code></li>
<li><code><a title="area_tw.tw_reach_friend_followers_check" href="#area_tw.tw_reach_friend_followers_check">tw_reach_friend_followers_check</a></code></li>
<li><code><a title="area_tw.tw_send_dm" href="#area_tw.tw_send_dm">tw_send_dm</a></code></li>
<li><code><a title="area_tw.tw_send_dm_check" href="#area_tw.tw_send_dm_check">tw_send_dm_check</a></code></li>
<li><code><a title="area_trigger.add_trigger" href="#area_trigger.add_trigger">add_trigger</a></code></li>
<li><code><a title="area_trigger.add_trigger_to_db" href="#area_trigger.add_trigger_to_db">add_trigger_to_db</a></code></li>
<li><code><a title="area_trigger.get_triggers" href="#area_trigger.get_triggers">get_triggers</a></code></li>
<li><code><a title="area_trigger.rmv_triggers" href="#area_trigger.rmv_triggers">rmv_triggers</a></code></li>
<li><code><a title="area_tools.check_token" href="#area_tools.check_token">check_token</a></code></li>
<li><code><a title="area_tools.get_trigger_by_jobid" href="#area_tools.get_trigger_by_jobid">get_trigger_by_jobid</a></code></li>
<li><code><a title="area_tools.get_user" href="#area_tools.get_user">get_user</a></code></li>
<li><code><a title="area_tools.serialize_response" href="#area_tools.serialize_response">serialize_response</a></code></li>
<li><code><a title="area_token.addGoogleToken" href="#area_token.addGoogleToken">addGoogleToken</a></code></li>
<li><code><a title="area_token.addTwitterToken" href="#area_token.addTwitterToken">addTwitterToken</a></code></li>
<li><code><a title="area_th.th_get_status" href="#area_th.th_get_status">th_get_status</a></code></li>
<li><code><a title="area_th.th_get_status_check" href="#area_th.th_get_status_check">th_get_status_check</a></code></li>
<li><code><a title="area_lol.lol_bestof" href="#area_lol.lol_bestof">lol_bestof</a></code></li>
<li><code><a title="area_lol.lol_bestof_check" href="#area_lol.lol_bestof_check">lol_bestof_check</a></code></li>
<li><code><a title="area_lol.lol_levelup" href="#area_lol.lol_levelup">lol_levelup</a></code></li>
<li><code><a title="area_lol.lol_levelup_check" href="#area_lol.lol_levelup_check">lol_levelup_check</a></code></li>
<li><code><a title="area_gh.github_commit" href="#area_gh.github_commit">github_commit</a></code></li>
<li><code><a title="area_gh.github_commit_check" href="#area_gh.github_commit_check">github_commit_check</a></code></li>
<li><code><a title="area_gh.github_stars" href="#area_gh.github_stars">github_stars</a></code></li>
<li><code><a title="area_gh.github_stars_check" href="#area_gh.github_stars_check">github_stars_check</a></code></li>
<li><code><a title="area_em.send_mail" href="#area_em.send_mail">send_mail</a></code></li>
<li><code><a title="area_em.send_mail_check" href="#area_em.send_mail_check">send_mail_check</a></code></li>
<li><code><a title="area_cr.cr_above_friend" href="#area_cr.cr_above_friend">cr_above_friend</a></code></li>
<li><code><a title="area_cr.cr_above_friend_check" href="#area_cr.cr_above_friend_check">cr_above_friend_check</a></code></li>
<li><code><a title="area_cr.cr_clan_score" href="#area_cr.cr_clan_score">cr_clan_score</a></code></li>
<li><code><a title="area_cr.cr_clan_score_check" href="#area_cr.cr_clan_score_check">cr_clan_score_check</a></code></li>
<li><code><a title="area_cr.cr_record" href="#area_cr.cr_record">cr_record</a></code></li>
<li><code><a title="area_cr.cr_record_check" href="#area_cr.cr_record_check">cr_record_check</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
<body>
<main>
<article id="content">
<header>
<h1 class="title"><code>area_cr</code> module</h1>
</header>
<section id="section-intro">
<details class="source">
<summary>Source code</summary>
<pre><code class="python">from flask import Blueprint, render_template, abort, Flask, redirect, url_for, session, request
from flask_oauthlib.client import OAuth
from area_db import db
from area_tools import check_token
import time
import atexit
import requests
import json

SECRET_KEY = &#39;development key&#39;
DEBUG = True
CR_KEY = &#34;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MjM4NiwiaWRlbiI6IjI0MzgyMTE0NTIxNDY4MTA4OSIsIm1kIjp7fSwidHMiOjE1NTExOTM3NDExNTl9.U1n33CUb84o66rvlvO_onApYP6zfwEhxrn5d1mvwvbE&#34;

def cr_clan_score_check(user, cr_data):
        &#34;&#34;&#34;
        Description\n
                Check function for CR action : clan score
        Parameters
                user : user dict\t
                cr_data : cr_data dict
        Return
                True or error message
        &#34;&#34;&#34;
        try:
                clan_tag = cr_data[&#34;clan_tag&#34;]
                score = int(cr_data[&#34;score&#34;])
        except:
                return &#34;Clash Royale : Missing tag or score&#34;
        url = &#34;https://api.royaleapi.com/clan/&#34; + clan_tag
        headers = {
                &#39;auth&#39;: CR_KEY
        }
        response = requests.request(&#34;GET&#34;, url, headers=headers)
        if response.status_code != 200:
                return &#34;Clash Royale : Invalid tag&#34;
        if response.json()[&#34;score&#34;] &gt; score:
                return &#34;Clash Royale : The score should be higher than the actual one&#34;
        return True

def cr_record_check(user, cr_data):
        &#34;&#34;&#34;
        Description\n
                Check function for CR action : clash royale record
        Parameters
                user : user dict\t
                cr_data : cr_data dict
        Return
                True or error message
        &#34;&#34;&#34;
        try:
                tag = cr_data[&#34;tag&#34;]
                record = int(cr_data[&#34;record&#34;])
        except:
                return &#34;Clash Royale : Missing tag or record&#34;
        url = &#34;https://api.royaleapi.com/player/&#34; + tag
        headers = {
                &#39;auth&#39;: CR_KEY
        }
        response = requests.request(&#34;GET&#34;, url, headers=headers)
        if response.status_code != 200:
                return &#34;Clash Royale : Invalid player tag&#34;
        if response.json()[&#34;trophies&#34;] &gt; record:
                return &#34;Clash Royale : Your record should be higher than your actual trophies&#34;
        return True

def cr_above_friend_check(user, cr_data):
        &#34;&#34;&#34;
        Description\n
                check function for CR action : above friend
        Parameters
                user : user dict\t
                cr_data : cr_data dict
        Return
                True or error message
        &#34;&#34;&#34;
        try:
                tag = cr_data[&#34;tag&#34;]
                friend_tag = cr_data[&#34;friend_tag&#34;]
        except:
                return &#34;Clash Royale : Missing tag or friend tag&#34;
        url = &#34;https://api.royaleapi.com/player/&#34; + tag + &#34;,&#34; + friend_tag
        headers = {
                &#39;auth&#39;: CR_KEY
        }
        response = requests.request(&#34;GET&#34;, url, headers=headers)
        if response.status_code != 200:
                return &#34;Clash Royale : Invalid tag or friend tag&#34;
        if response.json()[0][&#34;trophies&#34;] &gt; response.json()[1][&#34;trophies&#34;]:
                return &#34;Clash Royale : Your trophies shouldn&#39;t be higher than your friend one&#34;
        return True

def cr_record(user, id, reaction, job_id):
        &#34;&#34;&#34;
        Description\n
                Action function for CR service : triggers when you hit a chosen trophies record
        Parameters
                user : user dict\t
                id : trigger id
                reaction : reaction function\t
                job_id : id of apscheduler job
        Return
                True or error message
        &#34;&#34;&#34;
        tag = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;tag&#34;]
        url = &#34;https://api.royaleapi.com/player/&#34; + tag
        headers = {
                &#39;auth&#39;: CR_KEY
        }
        response = requests.request(&#34;GET&#34;, url, headers=headers)
        data = response.json()
        trophies = data[&#34;trophies&#34;]
        record = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;record&#34;]
        if trophies &gt;= int(record):
                reaction(user, id)

def cr_above_friend(user, id, reaction, job_id):
        &#34;&#34;&#34;
        Description\n
                Action function for CR service : triggers when you pass beyond a friend
        Parameters
                user : user dict\t
                id : trigger id
                reaction : reaction function\t
                job_id : id of apscheduler job
        Return
                True or error message
        &#34;&#34;&#34;
        tag = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;tag&#34;]
        friend_tag = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;friend_tag&#34;]
        url = &#34;https://api.royaleapi.com/player/&#34; + tag + &#34;,&#34; + friend_tag
        headers = {
                &#39;auth&#39; : CR_KEY
        }
        response = requests.request(&#34;GET&#34;, url, headers=headers)
        data = response.json()
        trophies = data[0][&#34;trophies&#34;]
        friend_trophies = data[1][&#34;trophies&#34;]
        if trophies &gt; friend_trophies:
                reaction(user, id)

def cr_clan_score(user, id, reaction, job_id):
        &#34;&#34;&#34;
        Description\n
                Action function for CR service : triggers when the clan hits a chosen score
        Parameters
                user : user dict\t
                id : trigger id
                reaction : reaction function\t
                job_id : id of apscheduler job
        Return
                True or error message
        &#34;&#34;&#34;
        clan_tag = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;clan_tag&#34;]
        url = &#34;https://api.royaleapi.com/clan/&#34; + clan_tag
        headers = {
                &#39;auth&#39;: CR_KEY
        }
        response = requests.request(&#34;GET&#34;, url, headers=headers)
        data = response.json()
        score = data[&#34;score&#34;]
        goal = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;goal&#34;]
        if score &gt;= int(goal):
                reaction(user, id)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="area_cr.cr_above_friend"><code class="name flex">
<span>def <span class="ident">cr_above_friend</span></span>(<span>user, id, reaction, job_id)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>Action function for CR service : triggers when you pass beyond a friend</dd>
<dt><strong><code>Parameters</code></strong></dt>
<dd>user : authenticated user
<br>
id : trigger id
<br>
reaction : reaction function
<br>
job_id : id of apscheduler job</dd>
<dt><strong><code>Return</code></strong></dt>
<dd>True or error message</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def cr_above_friend(user, id, reaction, job_id):
        &#34;&#34;&#34;
        Description\n
                Action function for CR service : triggers when you pass beyond a friend
        Parameters
                user : user dict\t
                id : trigger id
                reaction : reaction function\t
                job_id : id of apscheduler job
        Return
                True or error message
        &#34;&#34;&#34;
        tag = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;tag&#34;]
        friend_tag = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;friend_tag&#34;]
        url = &#34;https://api.royaleapi.com/player/&#34; + tag + &#34;,&#34; + friend_tag
        headers = {
                &#39;auth&#39; : CR_KEY
        }
        response = requests.request(&#34;GET&#34;, url, headers=headers)
        data = response.json()
        trophies = data[0][&#34;trophies&#34;]
        friend_trophies = data[1][&#34;trophies&#34;]
        if trophies &gt; friend_trophies:
                reaction(user, id)</code></pre>
</details>
</dd>
<dt id="area_cr.cr_above_friend_check"><code class="name flex">
<span>def <span class="ident">cr_above_friend_check</span></span>(<span>user, cr_data)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>check function for CR action : above friend</dd>
<dt><strong><code>Parameters</code></strong></dt>
<dd>user : authenticated user
<br>
cr_data : cr_data dict</dd>
<dt><strong><code>Return</code></strong></dt>
<dd>True or error message</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def cr_above_friend_check(user, cr_data):
        &#34;&#34;&#34;
        Description\n
                check function for CR action : above friend
        Parameters
                user : user dict\t
                cr_data : cr_data dict
        Return
                True or error message
        &#34;&#34;&#34;
        try:
                tag = cr_data[&#34;tag&#34;]
                friend_tag = cr_data[&#34;friend_tag&#34;]
        except:
                return &#34;Clash Royale : Missing tag or friend tag&#34;
        url = &#34;https://api.royaleapi.com/player/&#34; + tag + &#34;,&#34; + friend_tag
        headers = {
                &#39;auth&#39;: CR_KEY
        }
        response = requests.request(&#34;GET&#34;, url, headers=headers)
        if response.status_code != 200:
                return &#34;Clash Royale : Invalid tag or friend tag&#34;
        if response.json()[0][&#34;trophies&#34;] &gt; response.json()[1][&#34;trophies&#34;]:
                return &#34;Clash Royale : Your trophies shouldn&#39;t be higher than your friend one&#34;
        return True</code></pre>
</details>
</dd>
<dt id="area_cr.cr_clan_score"><code class="name flex">
<span>def <span class="ident">cr_clan_score</span></span>(<span>user, id, reaction, job_id)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>Action function for CR service : triggers when the clan hits a chosen score</dd>
<dt><strong><code>Parameters</code></strong></dt>
<dd>user : authenticated user
<br>
id : trigger id
<br>
reaction : reaction function
<br>
job_id : id of apscheduler job</dd>
<dt><strong><code>Return</code></strong></dt>
<dd>True or error message</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def cr_clan_score(user, id, reaction, job_id):
        &#34;&#34;&#34;
        Description\n
                Action function for CR service : triggers when the clan hits a chosen score
        Parameters
                user : user dict\t
                id : trigger id
                reaction : reaction function\t
                job_id : id of apscheduler job
        Return
                True or error message
        &#34;&#34;&#34;
        clan_tag = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;clan_tag&#34;]
        url = &#34;https://api.royaleapi.com/clan/&#34; + clan_tag
        headers = {
                &#39;auth&#39;: CR_KEY
        }
        response = requests.request(&#34;GET&#34;, url, headers=headers)
        data = response.json()
        score = data[&#34;score&#34;]
        goal = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;goal&#34;]
        if score &gt;= int(goal):
                reaction(user, id)</code></pre>
</details>
</dd>
<dt id="area_cr.cr_clan_score_check"><code class="name flex">
<span>def <span class="ident">cr_clan_score_check</span></span>(<span>user, cr_data)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>Check function for CR action : clan score</dd>
<dt><strong><code>Parameters</code></strong></dt>
<dd>user : authenticated user
<br>
cr_data : cr_data dict</dd>
<dt><strong><code>Return</code></strong></dt>
<dd>True or error message</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def cr_clan_score_check(user, cr_data):
        &#34;&#34;&#34;
        Description\n
                Check function for CR action : clan score
        Parameters
                user : user dict\t
                cr_data : cr_data dict
        Return
                True or error message
        &#34;&#34;&#34;
        try:
                clan_tag = cr_data[&#34;clan_tag&#34;]
                score = int(cr_data[&#34;score&#34;])
        except:
                return &#34;Clash Royale : Missing tag or score&#34;
        url = &#34;https://api.royaleapi.com/clan/&#34; + clan_tag
        headers = {
                &#39;auth&#39;: CR_KEY
        }
        response = requests.request(&#34;GET&#34;, url, headers=headers)
        if response.status_code != 200:
                return &#34;Clash Royale : Invalid tag&#34;
        if response.json()[&#34;score&#34;] &gt; score:
                return &#34;Clash Royale : The score should be higher than the actual one&#34;
        return True</code></pre>
</details>
</dd>
<dt id="area_cr.cr_record"><code class="name flex">
<span>def <span class="ident">cr_record</span></span>(<span>user, id, reaction, job_id)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>Action function for CR service : triggers when you hit a chosen trophies record</dd>
<dt><strong><code>Parameters</code></strong></dt>
<dd>user : authenticated user
<br>
id : trigger id
<br>
reaction : reaction function
<br>
job_id : id of apscheduler job</dd>
<dt><strong><code>Return</code></strong></dt>
<dd>True or error message</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def cr_record(user, id, reaction, job_id):
        &#34;&#34;&#34;
        Description\n
                Action function for CR service : triggers when you hit a chosen trophies record
        Parameters
                user : user dict\t
                id : trigger id
                reaction : reaction function\t
                job_id : id of apscheduler job
        Return
                True or error message
        &#34;&#34;&#34;
        tag = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;tag&#34;]
        url = &#34;https://api.royaleapi.com/player/&#34; + tag
        headers = {
                &#39;auth&#39;: CR_KEY
        }
        response = requests.request(&#34;GET&#34;, url, headers=headers)
        data = response.json()
        trophies = data[&#34;trophies&#34;]
        record = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;record&#34;]
        if trophies &gt;= int(record):
                reaction(user, id)</code></pre>
</details>
</dd>
<dt id="area_cr.cr_record_check"><code class="name flex">
<span>def <span class="ident">cr_record_check</span></span>(<span>user, cr_data)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>Check function for CR action : clash royale record</dd>
<dt><strong><code>Parameters</code></strong></dt>
<dd>user : authenticated user
<br>
cr_data : cr_data dict</dd>
<dt><strong><code>Return</code></strong></dt>
<dd>True or error message</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def cr_record_check(user, cr_data):
        &#34;&#34;&#34;
        Description\n
                Check function for CR action : clash royale record
        Parameters
                user : user dict\t
                cr_data : cr_data dict
        Return
                True or error message
        &#34;&#34;&#34;
        try:
                tag = cr_data[&#34;tag&#34;]
                record = int(cr_data[&#34;record&#34;])
        except:
                return &#34;Clash Royale : Missing tag or record&#34;
        url = &#34;https://api.royaleapi.com/player/&#34; + tag
        headers = {
                &#39;auth&#39;: CR_KEY
        }
        response = requests.request(&#34;GET&#34;, url, headers=headers)
        if response.status_code != 200:
                return &#34;Clash Royale : Invalid player tag&#34;
        if response.json()[&#34;trophies&#34;] &gt; record:
                return &#34;Clash Royale : Your record should be higher than your actual trophies&#34;
        return True</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<ul class="">
</ul>
</li>
</ul>
</nav>
</main>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
<body>
<main>
<article id="content">
<header>
<h1 class="title"><code>area_wh</code> module</h1>
</header>
<section id="section-intro">
<details class="source">
<summary>Source code</summary>
<pre><code class="python">from flask import Blueprint, render_template, abort, Flask, redirect, url_for, session, request
from area_db import db
from area_tools import check_token
import requests
import json

WH_KEY = &#34;129cc3031e2449e2a24160950190503&#34;

def weather_alert_hot_check(user, wh_data):
        &#34;&#34;&#34;
        Description\n
                Check function for wh action: weather alert hot
        Parameters
                user : user dict\t
                wh_data : wh_data dict
        Return
                True or error message
        &#34;&#34;&#34;
        try:
                city = wh_data[&#34;city&#34;]
                temperature = int(wh_data[&#34;temperature&#34;])
        except:
                return &#34;WeatherService : Missing city or temperature value&#34;
        url = &#34;https://api.apixu.com/v1/current.json?key=&#34; + WH_KEY + &#34;&amp;q=&#34; + city
        response = requests.request(&#34;GET&#34;, url)
        data = response.json()
        try :
                value = data[&#34;current&#34;][&#34;temp_c&#34;]
        except:
                return &#34;WeatherService : Invalid city or temperature&#34;
        if response.status_code != 200:
                return &#34;WeatherService : Invalid city or temperature&#34;
        if temperature &lt; value:
                return &#34;WeatherService : The temperature has already been reached&#34;
        return True

def weather_alert_hot(user, id, reaction, job_id):
        &#34;&#34;&#34;
        Description\n
                Action function for weather service : triggers a chosen temperature of a chosen city gets too high
        Parameters
                user : user dict\t
                id : trigger id
                reaction : reaction function\t
                job_id : id of apscheduler job
        &#34;&#34;&#34;
        city = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;city&#34;]
        temperature = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;temperature&#34;]
        url = &#34;https://api.apixu.com/v1/current.json?key=&#34; + WH_KEY + &#34;&amp;q=&#34; + city
        response = requests.request(&#34;GET&#34;, url)
        data = response.json()
        value = data[&#34;current&#34;][&#34;temp_c&#34;]
        if value &gt;= int(temperature):
                reaction(user, id)

def weather_alert_cold_check(user, wh_data):
        &#34;&#34;&#34;
        Description\n
                Check function for wh action: weather alert cold
        Parameters
                user : user dict\t
                wh_data : wh_data dict
        Return
                True or error message
        &#34;&#34;&#34;
        try:
                city = wh_data[&#34;city&#34;]
                temperature = int(wh_data[&#34;temperature&#34;])
        except:
                return &#34;WeatherService : Missing city or temperature value&#34;
        url = &#34;https://api.apixu.com/v1/current.json?key=&#34; + WH_KEY + &#34;&amp;q=&#34; + city
        response = requests.request(&#34;GET&#34;, url)
        data = response.json()
        try :
                value = data[&#34;current&#34;][&#34;temp_c&#34;]
        except:
                return &#34;WeatherService : invalid City or temperature&#34;
        if response.status_code != 200:
                return &#34;WeatherService : Invalid City or temperature&#34;
        if temperature &gt; value:
                return &#34;WeatherService : The temperature has already been reached&#34;
        return True

def weather_alert_cold(user, id, reaction, job_id):
        &#34;&#34;&#34;
        Description\n
                Action function for weather service : triggers a chosen temperature of a chosen city gets too coold
        Parameters
                user : user dict\t
                id : trigger id
                reaction : reaction function\t
                job_id : id of apscheduler job
        &#34;&#34;&#34;
        city = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;city&#34;]
        temperature = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;temperature&#34;]
        url = &#34;https://api.apixu.com/v1/current.json?key=&#34; + WH_KEY + &#34;&amp;q=&#34; + city
        response = requests.request(&#34;GET&#34;, url)
        data = response.json()
        value = data[&#34;current&#34;][&#34;temp_c&#34;]
        if value &lt;= int(temperature):
                reaction(user, id)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="area_wh.weather_alert_cold"><code class="name flex">
<span>def <span class="ident">weather_alert_cold</span></span>(<span>user, id, reaction, job_id)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>Action function for weather service : triggers a chosen temperature of a chosen city gets too coold</dd>
<dt><strong><code>Parameters</code></strong></dt>
<dd>user : authenticated user
<br>
id : trigger id
<br>
reaction : reaction function
<br>
job_id : id of apscheduler job</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def weather_alert_cold(user, id, reaction, job_id):
        &#34;&#34;&#34;
        Description\n
                Action function for weather service : triggers a chosen temperature of a chosen city gets too coold
        Parameters
                user : user dict\t
                id : trigger id
                reaction : reaction function\t
                job_id : id of apscheduler job
        &#34;&#34;&#34;
        city = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;city&#34;]
        temperature = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;temperature&#34;]
        url = &#34;https://api.apixu.com/v1/current.json?key=&#34; + WH_KEY + &#34;&amp;q=&#34; + city
        response = requests.request(&#34;GET&#34;, url)
        data = response.json()
        value = data[&#34;current&#34;][&#34;temp_c&#34;]
        if value &lt;= int(temperature):
                reaction(user, id)</code></pre>
</details>
</dd>
<dt id="area_wh.weather_alert_cold_check"><code class="name flex">
<span>def <span class="ident">weather_alert_cold_check</span></span>(<span>user, wh_data)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>Check function for wh action: weather alert cold</dd>
<dt><strong><code>Parameters</code></strong></dt>
<dd>user : authenticated user
<br>
wh_data : wh_data dict</dd>
<dt><strong><code>Return</code></strong></dt>
<dd>True or error message</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def weather_alert_cold_check(user, wh_data):
        &#34;&#34;&#34;
        Description\n
                Check function for wh action: weather alert cold
        Parameters
                user : user dict\t
                wh_data : wh_data dict
        Return
                True or error message
        &#34;&#34;&#34;
        try:
                city = wh_data[&#34;city&#34;]
                temperature = int(wh_data[&#34;temperature&#34;])
        except:
                return &#34;WeatherService : Missing city or temperature value&#34;
        url = &#34;https://api.apixu.com/v1/current.json?key=&#34; + WH_KEY + &#34;&amp;q=&#34; + city
        response = requests.request(&#34;GET&#34;, url)
        data = response.json()
        try :
                value = data[&#34;current&#34;][&#34;temp_c&#34;]
        except:
                return &#34;WeatherService : invalid City or temperature&#34;
        if response.status_code != 200:
                return &#34;WeatherService : Invalid City or temperature&#34;
        if temperature &gt; value:
                return &#34;WeatherService : The temperature has already been reached&#34;
        return True</code></pre>
</details>
</dd>
<dt id="area_wh.weather_alert_hot"><code class="name flex">
<span>def <span class="ident">weather_alert_hot</span></span>(<span>user, id, reaction, job_id)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>Action function for weather service : triggers a chosen temperature of a chosen city gets too high</dd>
<dt><strong><code>Parameters</code></strong></dt>
<dd>user : authenticated user
<br>
id : trigger id
<br>
reaction : reaction function
<br>
job_id : id of apscheduler job</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def weather_alert_hot(user, id, reaction, job_id):
        &#34;&#34;&#34;
        Description\n
                Action function for weather service : triggers a chosen temperature of a chosen city gets too high
        Parameters
                user : user dict\t
                id : trigger id
                reaction : reaction function\t
                job_id : id of apscheduler job
        &#34;&#34;&#34;
        city = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;city&#34;]
        temperature = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;temperature&#34;]
        url = &#34;https://api.apixu.com/v1/current.json?key=&#34; + WH_KEY + &#34;&amp;q=&#34; + city
        response = requests.request(&#34;GET&#34;, url)
        data = response.json()
        value = data[&#34;current&#34;][&#34;temp_c&#34;]
        if value &gt;= int(temperature):
                reaction(user, id)</code></pre>
</details>
</dd>
<dt id="area_wh.weather_alert_hot_check"><code class="name flex">
<span>def <span class="ident">weather_alert_hot_check</span></span>(<span>user, wh_data)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>Check function for wh action: weather alert hot</dd>
<dt><strong><code>Parameters</code></strong></dt>
<dd>user : authenticated user
<br>
wh_data : wh_data dict</dd>
<dt><strong><code>Return</code></strong></dt>
<dd>True or error message</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def weather_alert_hot_check(user, wh_data):
        &#34;&#34;&#34;
        Description\n
                Check function for wh action: weather alert hot
        Parameters
                user : user dict\t
                wh_data : wh_data dict
        Return
                True or error message
        &#34;&#34;&#34;
        try:
                city = wh_data[&#34;city&#34;]
                temperature = int(wh_data[&#34;temperature&#34;])
        except:
                return &#34;WeatherService : Missing city or temperature value&#34;
        url = &#34;https://api.apixu.com/v1/current.json?key=&#34; + WH_KEY + &#34;&amp;q=&#34; + city
        response = requests.request(&#34;GET&#34;, url)
        data = response.json()
        try :
                value = data[&#34;current&#34;][&#34;temp_c&#34;]
        except:
                return &#34;WeatherService : Invalid city or temperature&#34;
        if response.status_code != 200:
                return &#34;WeatherService : Invalid city or temperature&#34;
        if temperature &lt; value:
                return &#34;WeatherService : The temperature has already been reached&#34;
        return True</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<ul class="">
</ul>
</li>
</ul>
</nav>
</main>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
<body>
<main>
<article id="content">
<header>
<h1 class="title"><code>area_tw</code> module</h1>
</header>
<section id="section-intro">
<details class="source">
<summary>Source code</summary>
<pre><code class="python">from area_db import db
from requests_oauthlib import OAuth1
from urllib import parse
import requests

cons_key = &#39;sii8TAx8gZxNNuoRzzrievfG5&#39;
cons_secret = &#39;wCreM120FVL5b4YVfbu68gdQQA7WH3HSelat6YMGfgu2dM2aR8&#39;

def get_friend_followers(user, friend_name):
        url = &#34;https://api.twitter.com/1.1/users/show.json&#34;
        auth = OAuth1(cons_key, cons_secret, user[&#34;tokens&#34;][&#34;twitterToken&#34;], user[&#34;tokens&#34;][&#34;twitterSecret&#34;])
        params = [(&#39;screen_name&#39;, friend_name)]
        r = requests.get(url, auth=auth, params=params)
        data = r.json()
        return False if r.status_code != 200 else data[&#34;followers_count&#34;]

def get_tw_id(name, user):
        url = &#34;https://api.twitter.com/1.1/users/show.json&#34;
        params = [(&#39;screen_name&#39;, name)]
        auth = OAuth1(cons_key, cons_secret, user[&#34;tokens&#34;][&#34;twitterToken&#34;], user[&#34;tokens&#34;][&#34;twitterSecret&#34;])
        r = requests.get(url, auth=auth, params=params)
        data = r.json()
        return data[&#34;id&#34;]

def tw_send_dm_check(user, tw_data):
        &#34;&#34;&#34;
        Description\n
                Check function for tw reaction: tw send dm
        Parameters
                user : user dict\t
                tw_data : tw_data dict
        Return
                True or error message
        &#34;&#34;&#34;
        try:
                token = user[&#34;tokens&#34;][&#34;twitterToken&#34;]
                secret = user[&#34;tokens&#34;][&#34;twitterSecret&#34;]
        except:
                return &#34;Twitter : You&#39;re not connected&#34;
        try:
                message = tw_data[&#34;msg&#34;]
                dest = tw_data[&#34;dest&#34;]
        except:
                return &#34;Twitter : Missing message or recipient&#34;
        url = &#34;https://api.twitter.com/1.1/users/show.json&#34;
        params=[(&#39;screen_name&#39;, dest)]
        auth = OAuth1(cons_key, cons_secret, user[&#34;tokens&#34;][&#34;twitterToken&#34;], user[&#34;tokens&#34;][&#34;twitterSecret&#34;])
        r = requests.get(url, auth=auth, params=params)
        if r.status_code != 200:
                return &#34;Twitter : Invalid twitter screen name&#34;
        return True

def tw_send_dm(user, id):
        &#34;&#34;&#34;
        Description\n
                Reaction function for tw service : sends a direct message to given user
        Parameters
                user : user dict\t
                id : trigger id
        &#34;&#34;&#34;
        message = user[&#34;triggers&#34;][id][&#34;reaction&#34;][&#34;data&#34;][&#34;msg&#34;]
        dest = get_tw_id(user[&#34;triggers&#34;][id][&#34;reaction&#34;][&#34;data&#34;][&#34;dest&#34;], user)
        url = &#34;https://api.twitter.com/1.1/direct_messages/events/new.json&#34;
        auth = OAuth1(cons_key, cons_secret, user[&#34;tokens&#34;][&#34;twitterToken&#34;], user[&#34;tokens&#34;][&#34;twitterSecret&#34;])
        json = {
                &#34;event&#34;: {
                        &#34;type&#34;: &#34;message_create&#34;,
                        &#34;message_create&#34;: {
                                &#34;target&#34;: {
                                        &#34;recipient_id&#34;: dest
                                },
                                &#34;message_data&#34;: {
                                        &#34;text&#34;: message
                                }
                        }
                }
        }
        r = requests.post(url, auth=auth, json=json)

def tw_post_tweet_check(user, tw_data):
        &#34;&#34;&#34;
        Description\n
                Check function for tw reaction: tw post tweet
        Parameters
                user : user dict\t
                tw_data : tw_data dict
        Return
                True or error message
        &#34;&#34;&#34;
        try:
                token = user[&#34;tokens&#34;][&#34;twitterToken&#34;]
                secret = user[&#34;tokens&#34;][&#34;twitterSecret&#34;]
        except:
                return &#34;Twitter : You&#39;re not connected&#34;
        try:
                msg = tw_data[&#34;msg&#34;]
        except:
                return &#34;Twitter : Missing tweet content&#34;
        if len(msg) &gt; 0:
                return True
        return &#34;Twitter : Empty tweet can&#39;t be published&#34;

def tw_post_tweet(user, id):
        &#34;&#34;&#34;
        Description\n
                Reaction function for tw service : tweet through authenticated user
        Parameters
                user : user dict\t
                id : trigger id
        &#34;&#34;&#34;
        message = user[&#34;triggers&#34;][id][&#34;reaction&#34;][&#34;data&#34;][&#34;msg&#34;]
        url = &#34;https://api.twitter.com/1.1/statuses/update.json&#34;
        params=[(&#39;status&#39;, message)]
        auth = OAuth1(cons_key, cons_secret, user[&#34;tokens&#34;][&#34;twitterToken&#34;], user[&#34;tokens&#34;][&#34;twitterSecret&#34;])
        r = requests.post(url, auth=auth, params=params)

def tw_reach_followers_check(user, tw_data):
        &#34;&#34;&#34;
        Description\n
                Check function for tw action: tw reach followers
        Parameters
                user : user dict\t
                tw_data : tw_data dict
        Return
                True or error message
        &#34;&#34;&#34;
        try:
                token = user[&#34;tokens&#34;][&#34;twitterToken&#34;]
                secret = user[&#34;tokens&#34;][&#34;twitterSecret&#34;]
        except:
                return &#34;Twitter : You&#39;re not connected&#34;
        try:
                followers = tw_data[&#34;followers&#34;]
        except:
                return &#34;Twitter : Missing followers count&#34;
        url = &#34;https://api.twitter.com/1.1/account/verify_credentials.json&#34;
        auth = OAuth1(cons_key, cons_secret, user[&#34;tokens&#34;][&#34;twitterToken&#34;], user[&#34;tokens&#34;][&#34;twitterSecret&#34;])
        r = requests.get(url, auth=auth)
        if r.status_code != 200:
                return &#34;Twitter : Can&#39;t identify you&#34;
        data = r.json()
        if data[&#34;followers_count&#34;] &gt;= int(followers):
                return &#34;Twitter : Followers count already reached&#34;
        return True

def tw_reach_followers(user, id, reaction, job_id):
        &#34;&#34;&#34;
        Description\n
                Action function for tw service : triggers when a chosen followers number is hit
        Parameters
                user : user dict\t
                id : trigger id
                reaction : reaction function\t
                job_id : id of apscheduler job
        &#34;&#34;&#34;
        followers = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;followers&#34;]
        url = &#34;https://api.twitter.com/1.1/account/verify_credentials.json&#34;
        auth = OAuth1(cons_key, cons_secret, user[&#34;tokens&#34;][&#34;twitterToken&#34;], user[&#34;tokens&#34;][&#34;twitterSecret&#34;])
        r = requests.get(url, auth=auth)
        data = r.json()
        if data[&#34;followers_count&#34;] &gt;= int(followers):
                reaction(user, id)

def tw_reach_friend_followers_check(user, tw_data):
        &#34;&#34;&#34;
        Description\n
                Check function for tw action: tw reach friend followers
        Parameters
                user : user dict\t
                tw_data : tw_data dict
        Return
                True or error message
        &#34;&#34;&#34;
        try:
                token = user[&#34;tokens&#34;][&#34;twitterToken&#34;]
                secret = user[&#34;tokens&#34;][&#34;twitterSecret&#34;]
        except:
                return &#34;Twitter : You&#39;re not connected&#34;
        try:
                friend_name = tw_data[&#34;friendName&#34;]
        except:
                return &#34;Twitter : Missing friend&#39;s name&#34;
        friend_followers = get_friend_followers(user, friend_name)
        if friend_followers == False:
                return &#34;Twitter : Invalid friend name&#34;
        url = &#34;https://api.twitter.com/1.1/account/verify_credentials.json&#34;
        auth = OAuth1(cons_key, cons_secret, user[&#34;tokens&#34;][&#34;twitterToken&#34;], user[&#34;tokens&#34;][&#34;twitterSecret&#34;])
        r = requests.get(url, auth=auth)
        if r.status_code != 200:
                return &#34;Twitter : Can&#39;t identify you&#34;
        data = r.json()
        if data[&#34;followers_count&#34;] &gt;= friend_followers:
                return &#34;Twitter : Followers count already reached&#34;
        return True

def tw_reach_friend_followers(user, id, reaction, job_id):
        &#34;&#34;&#34;
        Description\n
                Action function for tw service : triggers when you have more followers than a chosen user
        Parameters
                user : user dict\t
                id : trigger id
                reaction : reaction function\t
                job_id : id of apscheduler job
        &#34;&#34;&#34;
        friend_name = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;friendName&#34;]
        url = &#34;https://api.twitter.com/1.1/account/verify_credentials.json&#34;
        auth = OAuth1(cons_key, cons_secret, user[&#34;tokens&#34;][&#34;twitterToken&#34;], user[&#34;tokens&#34;][&#34;twitterSecret&#34;])
        r = requests.get(url, auth=auth)
        data = r.json()
        followers = data[&#34;followers_count&#34;]
        friend_followers = get_friend_followers(user, friend_name)
        if followers &gt;= friend_followers:
                reaction(user, id)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="area_tw.get_friend_followers"><code class="name flex">
<span>def <span class="ident">get_friend_followers</span></span>(<span>user, friend_name)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def get_friend_followers(user, friend_name):
        url = &#34;https://api.twitter.com/1.1/users/show.json&#34;
        auth = OAuth1(cons_key, cons_secret, user[&#34;tokens&#34;][&#34;twitterToken&#34;], user[&#34;tokens&#34;][&#34;twitterSecret&#34;])
        params = [(&#39;screen_name&#39;, friend_name)]
        r = requests.get(url, auth=auth, params=params)
        data = r.json()
        return False if r.status_code != 200 else data[&#34;followers_count&#34;]</code></pre>
</details>
</dd>
<dt id="area_tw.get_tw_id"><code class="name flex">
<span>def <span class="ident">get_tw_id</span></span>(<span>name, user)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def get_tw_id(name, user):
        url = &#34;https://api.twitter.com/1.1/users/show.json&#34;
        params = [(&#39;screen_name&#39;, name)]
        auth = OAuth1(cons_key, cons_secret, user[&#34;tokens&#34;][&#34;twitterToken&#34;], user[&#34;tokens&#34;][&#34;twitterSecret&#34;])
        r = requests.get(url, auth=auth, params=params)
        data = r.json()
        return data[&#34;id&#34;]</code></pre>
</details>
</dd>
<dt id="area_tw.tw_post_tweet"><code class="name flex">
<span>def <span class="ident">tw_post_tweet</span></span>(<span>user, id)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>Reaction function for tw service : tweet through authenticated user</dd>
<dt><strong><code>Parameters</code></strong></dt>
<dd>user : authenticated user
<br>
id : trigger id</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def tw_post_tweet(user, id):
        &#34;&#34;&#34;
        Description\n
                Reaction function for tw service : tweet through authenticated user
        Parameters
                user : user dict\t
                id : trigger id
        &#34;&#34;&#34;
        message = user[&#34;triggers&#34;][id][&#34;reaction&#34;][&#34;data&#34;][&#34;msg&#34;]
        url = &#34;https://api.twitter.com/1.1/statuses/update.json&#34;
        params=[(&#39;status&#39;, message)]
        auth = OAuth1(cons_key, cons_secret, user[&#34;tokens&#34;][&#34;twitterToken&#34;], user[&#34;tokens&#34;][&#34;twitterSecret&#34;])
        r = requests.post(url, auth=auth, params=params)</code></pre>
</details>
</dd>
<dt id="area_tw.tw_post_tweet_check"><code class="name flex">
<span>def <span class="ident">tw_post_tweet_check</span></span>(<span>user, tw_data)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>Check function for tw reaction: tw post tweet</dd>
<dt><strong><code>Parameters</code></strong></dt>
<dd>user : authenticated user
<br>
tw_data : tw_data dict</dd>
<dt><strong><code>Return</code></strong></dt>
<dd>True or error message</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def tw_post_tweet_check(user, tw_data):
        &#34;&#34;&#34;
        Description\n
                Check function for tw reaction: tw post tweet
        Parameters
                user : user dict\t
                tw_data : tw_data dict
        Return
                True or error message
        &#34;&#34;&#34;
        try:
                token = user[&#34;tokens&#34;][&#34;twitterToken&#34;]
                secret = user[&#34;tokens&#34;][&#34;twitterSecret&#34;]
        except:
                return &#34;Twitter : You&#39;re not connected&#34;
        try:
                msg = tw_data[&#34;msg&#34;]
        except:
                return &#34;Twitter : Missing tweet content&#34;
        if len(msg) &gt; 0:
                return True
        return &#34;Twitter : Empty tweet can&#39;t be published&#34;</code></pre>
</details>
</dd>
<dt id="area_tw.tw_reach_followers"><code class="name flex">
<span>def <span class="ident">tw_reach_followers</span></span>(<span>user, id, reaction, job_id)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>Action function for tw service : triggers when a chosen followers number is hit</dd>
<dt><strong><code>Parameters</code></strong></dt>
<dd>user : authenticated user
<br>
id : trigger id
<br>
reaction : reaction function
<br>
job_id : id of apscheduler job</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def tw_reach_followers(user, id, reaction, job_id):
        &#34;&#34;&#34;
        Description\n
                Action function for tw service : triggers when a chosen followers number is hit
        Parameters
                user : user dict\t
                id : trigger id
                reaction : reaction function\t
                job_id : id of apscheduler job
        &#34;&#34;&#34;
        followers = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;followers&#34;]
        url = &#34;https://api.twitter.com/1.1/account/verify_credentials.json&#34;
        auth = OAuth1(cons_key, cons_secret, user[&#34;tokens&#34;][&#34;twitterToken&#34;], user[&#34;tokens&#34;][&#34;twitterSecret&#34;])
        r = requests.get(url, auth=auth)
        data = r.json()
        if data[&#34;followers_count&#34;] &gt;= int(followers):
                reaction(user, id)</code></pre>
</details>
</dd>
<dt id="area_tw.tw_reach_followers_check"><code class="name flex">
<span>def <span class="ident">tw_reach_followers_check</span></span>(<span>user, tw_data)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>Check function for tw action: tw reach followers</dd>
<dt><strong><code>Parameters</code></strong></dt>
<dd>user : authenticated user
<br>
tw_data : tw_data dict</dd>
<dt><strong><code>Return</code></strong></dt>
<dd>True or error message</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def tw_reach_followers_check(user, tw_data):
        &#34;&#34;&#34;
        Description\n
                Check function for tw action: tw reach followers
        Parameters
                user : user dict\t
                tw_data : tw_data dict
        Return
                True or error message
        &#34;&#34;&#34;
        try:
                token = user[&#34;tokens&#34;][&#34;twitterToken&#34;]
                secret = user[&#34;tokens&#34;][&#34;twitterSecret&#34;]
        except:
                return &#34;Twitter : You&#39;re not connected&#34;
        try:
                followers = tw_data[&#34;followers&#34;]
        except:
                return &#34;Twitter : Missing followers count&#34;
        url = &#34;https://api.twitter.com/1.1/account/verify_credentials.json&#34;
        auth = OAuth1(cons_key, cons_secret, user[&#34;tokens&#34;][&#34;twitterToken&#34;], user[&#34;tokens&#34;][&#34;twitterSecret&#34;])
        r = requests.get(url, auth=auth)
        if r.status_code != 200:
                return &#34;Twitter : Can&#39;t identify you&#34;
        data = r.json()
        if data[&#34;followers_count&#34;] &gt;= int(followers):
                return &#34;Twitter : Followers count already reached&#34;
        return True</code></pre>
</details>
</dd>
<dt id="area_tw.tw_reach_friend_followers"><code class="name flex">
<span>def <span class="ident">tw_reach_friend_followers</span></span>(<span>user, id, reaction, job_id)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>Action function for tw service : triggers when you have more followers than a chosen user</dd>
<dt><strong><code>Parameters</code></strong></dt>
<dd>user : authenticated user
<br>
id : trigger id
<br>
reaction : reaction function
<br>
job_id : id of apscheduler job</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def tw_reach_friend_followers(user, id, reaction, job_id):
        &#34;&#34;&#34;
        Description\n
                Action function for tw service : triggers when you have more followers than a chosen user
        Parameters
                user : user dict\t
                id : trigger id
                reaction : reaction function\t
                job_id : id of apscheduler job
        &#34;&#34;&#34;
        friend_name = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;friendName&#34;]
        url = &#34;https://api.twitter.com/1.1/account/verify_credentials.json&#34;
        auth = OAuth1(cons_key, cons_secret, user[&#34;tokens&#34;][&#34;twitterToken&#34;], user[&#34;tokens&#34;][&#34;twitterSecret&#34;])
        r = requests.get(url, auth=auth)
        data = r.json()
        followers = data[&#34;followers_count&#34;]
        friend_followers = get_friend_followers(user, friend_name)
        if followers &gt;= friend_followers:
                reaction(user, id)</code></pre>
</details>
</dd>
<dt id="area_tw.tw_reach_friend_followers_check"><code class="name flex">
<span>def <span class="ident">tw_reach_friend_followers_check</span></span>(<span>user, tw_data)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>Check function for tw action: tw reach friend followers</dd>
<dt><strong><code>Parameters</code></strong></dt>
<dd>user : authenticated user
<br>
tw_data : tw_data dict</dd>
<dt><strong><code>Return</code></strong></dt>
<dd>True or error message</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def tw_reach_friend_followers_check(user, tw_data):
        &#34;&#34;&#34;
        Description\n
                Check function for tw action: tw reach friend followers
        Parameters
                user : user dict\t
                tw_data : tw_data dict
        Return
                True or error message
        &#34;&#34;&#34;
        try:
                token = user[&#34;tokens&#34;][&#34;twitterToken&#34;]
                secret = user[&#34;tokens&#34;][&#34;twitterSecret&#34;]
        except:
                return &#34;Twitter : You&#39;re not connected&#34;
        try:
                friend_name = tw_data[&#34;friendName&#34;]
        except:
                return &#34;Twitter : Missing friend&#39;s name&#34;
        friend_followers = get_friend_followers(user, friend_name)
        if friend_followers == False:
                return &#34;Twitter : Invalid friend name&#34;
        url = &#34;https://api.twitter.com/1.1/account/verify_credentials.json&#34;
        auth = OAuth1(cons_key, cons_secret, user[&#34;tokens&#34;][&#34;twitterToken&#34;], user[&#34;tokens&#34;][&#34;twitterSecret&#34;])
        r = requests.get(url, auth=auth)
        if r.status_code != 200:
                return &#34;Twitter : Can&#39;t identify you&#34;
        data = r.json()
        if data[&#34;followers_count&#34;] &gt;= friend_followers:
                return &#34;Twitter : Followers count already reached&#34;
        return True</code></pre>
</details>
</dd>
<dt id="area_tw.tw_send_dm"><code class="name flex">
<span>def <span class="ident">tw_send_dm</span></span>(<span>user, id)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>Reaction function for tw service : sends a direct message to given user</dd>
<dt><strong><code>Parameters</code></strong></dt>
<dd>user : authenticated user
<br>
id : trigger id</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def tw_send_dm(user, id):
        &#34;&#34;&#34;
        Description\n
                Reaction function for tw service : sends a direct message to given user
        Parameters
                user : user dict\t
                id : trigger id
        &#34;&#34;&#34;
        message = user[&#34;triggers&#34;][id][&#34;reaction&#34;][&#34;data&#34;][&#34;msg&#34;]
        dest = get_tw_id(user[&#34;triggers&#34;][id][&#34;reaction&#34;][&#34;data&#34;][&#34;dest&#34;], user)
        url = &#34;https://api.twitter.com/1.1/direct_messages/events/new.json&#34;
        auth = OAuth1(cons_key, cons_secret, user[&#34;tokens&#34;][&#34;twitterToken&#34;], user[&#34;tokens&#34;][&#34;twitterSecret&#34;])
        json = {
                &#34;event&#34;: {
                        &#34;type&#34;: &#34;message_create&#34;,
                        &#34;message_create&#34;: {
                                &#34;target&#34;: {
                                        &#34;recipient_id&#34;: dest
                                },
                                &#34;message_data&#34;: {
                                        &#34;text&#34;: message
                                }
                        }
                }
        }
        r = requests.post(url, auth=auth, json=json)</code></pre>
</details>
</dd>
<dt id="area_tw.tw_send_dm_check"><code class="name flex">
<span>def <span class="ident">tw_send_dm_check</span></span>(<span>user, tw_data)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>Check function for tw reaction: tw send dm</dd>
<dt><strong><code>Parameters</code></strong></dt>
<dd>user : authenticated user
<br>
tw_data : tw_data dict</dd>
<dt><strong><code>Return</code></strong></dt>
<dd>True or error message</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def tw_send_dm_check(user, tw_data):
        &#34;&#34;&#34;
        Description\n
                Check function for tw reaction: tw send dm
        Parameters
                user : user dict\t
                tw_data : tw_data dict
        Return
                True or error message
        &#34;&#34;&#34;
        try:
                token = user[&#34;tokens&#34;][&#34;twitterToken&#34;]
                secret = user[&#34;tokens&#34;][&#34;twitterSecret&#34;]
        except:
                return &#34;Twitter : You&#39;re not connected&#34;
        try:
                message = tw_data[&#34;msg&#34;]
                dest = tw_data[&#34;dest&#34;]
        except:
                return &#34;Twitter : Missing message or recipient&#34;
        url = &#34;https://api.twitter.com/1.1/users/show.json&#34;
        params=[(&#39;screen_name&#39;, dest)]
        auth = OAuth1(cons_key, cons_secret, user[&#34;tokens&#34;][&#34;twitterToken&#34;], user[&#34;tokens&#34;][&#34;twitterSecret&#34;])
        r = requests.get(url, auth=auth, params=params)
        if r.status_code != 200:
                return &#34;Twitter : Invalid twitter screen name&#34;
        return True</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<ul class="">
</ul>
</li>
</ul>
</nav>
</main>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
<body>
<main>
<article id="content">
<header>
<h1 class="title"><code>area_trigger</code> module</h1>
</header>
<section id="section-intro">
<details class="source">
<summary>Source code</summary>
<pre><code class="python">from apscheduler.schedulers.background import BackgroundScheduler
from flask import request, Blueprint
from area_db import db
from area_cr import cr_record, cr_record_check, cr_above_friend, cr_above_friend_check, cr_clan_score, cr_clan_score_check
from area_tw import tw_post_tweet, tw_post_tweet_check, tw_send_dm, tw_send_dm_check, tw_reach_followers_check, tw_reach_followers, tw_reach_friend_followers_check, tw_reach_friend_followers
from area_tools import serialize_response, check_token, get_user
from area_cm import crypto_value_check, crypto_value
from area_gh import github_commit_check, github_commit, github_stars, github_stars_check
from area_em import send_mail, send_mail_check
from area_th import th_get_status, th_get_status_check
from area_wh import weather_alert_hot, weather_alert_hot_check, weather_alert_cold, weather_alert_cold_check
from area_yt import yt_subscribers_record_check, yt_subscribers_record, yt_subscribers_above_channel_check, yt_subscribers_above_channel, yt_new_video, yt_new_video_check
from area_lol import lol_levelup, lol_levelup_check, lol_bestof, lol_bestof_check
import time

action_array = [
    [cr_record, 180, cr_record_check],
    [cr_above_friend, 180, cr_above_friend_check],
    [cr_clan_score, 3600, cr_clan_score_check],
    [crypto_value, 60, crypto_value_check],
    [github_commit, 60, github_commit_check],
    [th_get_status, 360, th_get_status_check],
    [weather_alert_hot, 1800, weather_alert_hot_check],
    [weather_alert_cold, 1800, weather_alert_cold_check],
    [tw_reach_followers, 180, tw_reach_followers_check],
    [tw_reach_friend_followers, 180, tw_reach_friend_followers_check],
    [yt_subscribers_record, 60, yt_subscribers_record_check],
    [yt_subscribers_above_channel, 60, yt_subscribers_above_channel_check],
    [yt_new_video, 360, yt_new_video_check],
    [github_stars, 180, github_stars_check],
    [lol_levelup, 1200, lol_levelup_check],
    [lol_bestof, 1200, lol_bestof_check]
]

reaction_array = [
    [tw_post_tweet, tw_post_tweet_check],
    [tw_send_dm, tw_send_dm_check],
    [send_mail, send_mail_check]
]

area_trigger_bp = Blueprint(&#39;area_trigger_bp&#39;, __name__)

scheduler = BackgroundScheduler(timezone=&#34;Europe/Paris&#34;)
scheduler.start()

@area_trigger_bp.route(&#34;/rmvTriggers&#34;, methods=[&#39;POST&#39;])
def rmv_triggers():
    &#34;&#34;&#34;
    Description\n
        POST route to remove a trigger from a user list of triggers
    Json-data
        triggerId : trigger id of authenticated user\t
    Headers
        Authorization : Bearer token
    Return
        200 code for succes and 400 for failure
    &#34;&#34;&#34;
    users = db.child(&#39;Users&#39;).get()
    authorization = request.headers.get(&#34;Authorization&#34;)
    token = check_token(authorization, users)
    if token == False:
        return serialize_response(&#39;Unkown user&#39;, {}, 400)
    user = get_user(authorization.split(&#39; &#39;)[1], users)
    val = user.val()
    data = request.json
    trigger_id = int(data[&#34;triggerId&#34;])
    job_id = val[&#34;triggers&#34;][trigger_id][&#34;job_id&#34;]
    try:
        if len(val[&#34;triggers&#34;]) == 1:
            val[&#34;triggers&#34;] = [-1]
        else:
            val[&#34;triggers&#34;].pop(trigger_id)
    except:
        return serialize_response(&#39;Invalid trigger id&#39;, {}, 400)
    try:
        scheduler.remove_job(job_id)
        db.child(&#34;Users&#34;).child(user.key()).set(val)
    except:
        return serialize_response(&#39;Invalid trigger id&#39;, {}, 400)
    return serialize_response(&#39;Trigger deleted&#39;, {}, 200)

@area_trigger_bp.route(&#34;/getTriggers&#34;, methods=[&#39;GET&#39;])
def get_triggers():
    &#34;&#34;&#34;
    Description\n
        GET route to get all user triggers
    Json-data
        twitterToken : twitter token from oauth\t
        twitterSecret : twitter secret from oauth
    Headers
        Authorization : Bearer token
    Return
        200 code for succes and 400 for failure
    &#34;&#34;&#34;
    users = db.child(&#39;Users&#39;).get()
    authorization = request.headers.get(&#34;Authorization&#34;)
    user = check_token(authorization, users)
    if user == False:
        return serialize_response(&#39;Unkown user&#39;, {}, 400)
    return serialize_response(&#39;Here are the triggers&#39;, {&#34;triggers&#34;: user[&#34;triggers&#34;]}, 200)

def add_trigger_to_db(job_id, user, key, action_id, reaction_id, action_data, reaction_data):
    &#34;&#34;&#34;
    Description\n
        Add new trigger to database
    Parameters
        job_id : apscheduler jobid\t
        user : authenticated user\t
        key : \t
        action_id : index of array action
        reaction_id : index of reaction id
        action_data : json data linked to action
        reaction_data : json data linked to reaction
    Return
        trigger id
    &#34;&#34;&#34;
    trigger = {
        &#34;job_id&#34;: job_id,
        &#34;action&#34;: {
            &#34;id&#34;: action_id,
            &#34;data&#34;: action_data
        },
        &#34;reaction&#34;: {
            &#34;id&#34;: reaction_id,
            &#34;data&#34;: reaction_data
        }
    }
    triggers = user[&#34;triggers&#34;]
    if (triggers[0] == -1):
        triggers[0] = trigger
    else:
        user[&#34;triggers&#34;].append(trigger)
    db.child(&#34;Users&#34;).child(key).set(user)
    return len(user[&#34;triggers&#34;]) - 1

@area_trigger_bp.route(&#34;/addTrigger&#34;, methods=[&#39;POST&#39;])
def add_trigger():
    &#34;&#34;&#34;
    Description\n
        POST route to add a new trigger
    Json-data
        action_id = array index of actions\t
        reaction_id = array index of reactions\t
        action_data = json data of action\t
        reaction_data = json data of reaction\t
    Headers
        Authorization : Bearer token
    Return
        200 code for succes and 400 for failure
    &#34;&#34;&#34;
    users = db.child(&#39;Users&#39;).get()
    authorization = request.headers.get(&#34;Authorization&#34;)
    token = check_token(authorization, users)
    if token == False:
        return serialize_response(&#39;Unkown user&#39;, {}, 400)
    user = get_user(authorization.split(&#39; &#39;)[1], users)
    data = request.json
    try:
        action_id = int(data[&#34;action_id&#34;])
        reaction_id = int(data[&#34;reaction_id&#34;])
        action_data = data[&#34;action_data&#34;]
        reaction_data = data[&#34;reaction_data&#34;]
    except:
        return serialize_response(&#39;Missing parameters&#39;, {}, 400)
    action = action_array[action_id]
    reaction = reaction_array[reaction_id]
    action_res = action[2](user.val(), action_data)
    if action_res != True:
        return serialize_response(action_res, {}, 400)
    reaction_res = reaction[1](user.val(), reaction_data)
    if reaction_res != True:
        return serialize_response(reaction_res, {}, 400)
    job_id = user.key() + str(int(time.time() * 10000))
    trigger_id = add_trigger_to_db(job_id, user.val(), user.key(), action_id, reaction_id, action_data, reaction_data)
    val = user.val()
    args = [val, trigger_id, reaction[0], job_id]
    scheduler.add_job(func=action[0], trigger=&#34;interval&#34;, seconds=action[1], args=args, max_instances=100, id=job_id)
    return serialize_response(&#39;Here you are&#39;, {}, 200)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="area_trigger.add_trigger"><code class="name flex">
<span>def <span class="ident">add_trigger</span></span>(<span>)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>POST route to add a new trigger</dd>
<dt><strong><code>Json-data</code></strong></dt>
<dd>action_id : array index of actions
<br>
reaction_id : array index of reactions
<br>
action_data : json data of action
<br>
reaction_data : json data of reaction</dd>
<dt><strong><code>Headers</code></strong></dt>
<dd>Authorization : Bearer token</dd>
<dt><strong><code>Return</code></strong></dt>
<dd>200 code for succes and 400 for failure</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">@area_trigger_bp.route(&#34;/addTrigger&#34;, methods=[&#39;POST&#39;])
def add_trigger():
    &#34;&#34;&#34;
    Description\n
        POST route to add a new trigger
    Json-data
        action_id = array index of actions\t
        reaction_id = array index of reactions\t
        action_data = json data of action\t
        reaction_data = json data of reaction\t
    Headers
        Authorization : Bearer token
    Return
        200 code for succes and 400 for failure
    &#34;&#34;&#34;
    users = db.child(&#39;Users&#39;).get()
    authorization = request.headers.get(&#34;Authorization&#34;)
    token = check_token(authorization, users)
    if token == False:
        return serialize_response(&#39;Unkown user&#39;, {}, 400)
    user = get_user(authorization.split(&#39; &#39;)[1], users)
    data = request.json
    try:
        action_id = int(data[&#34;action_id&#34;])
        reaction_id = int(data[&#34;reaction_id&#34;])
        action_data = data[&#34;action_data&#34;]
        reaction_data = data[&#34;reaction_data&#34;]
    except:
        return serialize_response(&#39;Missing parameters&#39;, {}, 400)
    action = action_array[action_id]
    reaction = reaction_array[reaction_id]
    action_res = action[2](user.val(), action_data)
    if action_res != True:
        return serialize_response(action_res, {}, 400)
    reaction_res = reaction[1](user.val(), reaction_data)
    if reaction_res != True:
        return serialize_response(reaction_res, {}, 400)
    job_id = user.key() + str(int(time.time() * 10000))
    trigger_id = add_trigger_to_db(job_id, user.val(), user.key(), action_id, reaction_id, action_data, reaction_data)
    val = user.val()
    args = [val, trigger_id, reaction[0], job_id]
    scheduler.add_job(func=action[0], trigger=&#34;interval&#34;, seconds=action[1], args=args, max_instances=100, id=job_id)
    return serialize_response(&#39;Here you are&#39;, {}, 200)</code></pre>
</details>
</dd>
<dt id="area_trigger.add_trigger_to_db"><code class="name flex">
<span>def <span class="ident">add_trigger_to_db</span></span>(<span>job_id, user, key, action_id, reaction_id, action_data, reaction_data)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>Add new trigger to database</dd>
<dt><strong><code>Parameters</code></strong></dt>
<dd>job_id : apscheduler jobid
<br>
user : authenticated user
<br>
key : <br>
action_id : index of array action
reaction_id : index of reaction id
action_data : json data linked to action
reaction_data : json data linked to reaction</dd>
<dt><strong><code>Return</code></strong></dt>
<dd>trigger id</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def add_trigger_to_db(job_id, user, key, action_id, reaction_id, action_data, reaction_data):
    &#34;&#34;&#34;
    Description\n
        Add new trigger to database
    Parameters
        job_id : apscheduler jobid\t
        user : authenticated user\t
        key : \t
        action_id : index of array action
        reaction_id : index of reaction id
        action_data : json data linked to action
        reaction_data : json data linked to reaction
    Return
        trigger id
    &#34;&#34;&#34;
    trigger = {
        &#34;job_id&#34;: job_id,
        &#34;action&#34;: {
            &#34;id&#34;: action_id,
            &#34;data&#34;: action_data
        },
        &#34;reaction&#34;: {
            &#34;id&#34;: reaction_id,
            &#34;data&#34;: reaction_data
        }
    }
    triggers = user[&#34;triggers&#34;]
    if (triggers[0] == -1):
        triggers[0] = trigger
    else:
        user[&#34;triggers&#34;].append(trigger)
    db.child(&#34;Users&#34;).child(key).set(user)
    return len(user[&#34;triggers&#34;]) - 1</code></pre>
</details>
</dd>
<dt id="area_trigger.get_triggers"><code class="name flex">
<span>def <span class="ident">get_triggers</span></span>(<span>)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>GET route to get all user triggers</dd>
<dt><strong><code>Json-data</code></strong></dt>
<dd>twitterToken : twitter token from oauth
<br>
twitterSecret : twitter secret from oauth</dd>
<dt><strong><code>Headers</code></strong></dt>
<dd>Authorization : Bearer token</dd>
<dt><strong><code>Return</code></strong></dt>
<dd>200 code for succes and 400 for failure</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">@area_trigger_bp.route(&#34;/getTriggers&#34;, methods=[&#39;GET&#39;])
def get_triggers():
    &#34;&#34;&#34;
    Description\n
        GET route to get all user triggers
    Json-data
        twitterToken : twitter token from oauth\t
        twitterSecret : twitter secret from oauth
    Headers
        Authorization : Bearer token
    Return
        200 code for succes and 400 for failure
    &#34;&#34;&#34;
    users = db.child(&#39;Users&#39;).get()
    authorization = request.headers.get(&#34;Authorization&#34;)
    user = check_token(authorization, users)
    if user == False:
        return serialize_response(&#39;Unkown user&#39;, {}, 400)
    return serialize_response(&#39;Here are the triggers&#39;, {&#34;triggers&#34;: user[&#34;triggers&#34;]}, 200)</code></pre>
</details>
</dd>
<dt id="area_trigger.rmv_triggers"><code class="name flex">
<span>def <span class="ident">rmv_triggers</span></span>(<span>)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>POST route to remove a trigger from a user list of triggers</dd>
<dt><strong><code></colgroup>Json-data</code></strong></dt>
<dd>triggerId : trigger id of authenticated user</dd>
<dt><strong><code>Headers</code></strong></dt>
<dd>Authorization : Bearer token</dd>
<dt><strong><code>Return</code></strong></dt>
<dd>200 code for succes and 400 for failure</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">@area_trigger_bp.route(&#34;/rmvTriggers&#34;, methods=[&#39;POST&#39;])
def rmv_triggers():
    &#34;&#34;&#34;
    Description\n
        POST route to remove a trigger from a user list of triggers
    Json-data
        triggerId : trigger id of authenticated user\t
    Headers
        Authorization : Bearer token
    Return
        200 code for succes and 400 for failure
    &#34;&#34;&#34;
    users = db.child(&#39;Users&#39;).get()
    authorization = request.headers.get(&#34;Authorization&#34;)
    token = check_token(authorization, users)
    if token == False:
        return serialize_response(&#39;Unkown user&#39;, {}, 400)
    user = get_user(authorization.split(&#39; &#39;)[1], users)
    val = user.val()
    data = request.json
    trigger_id = int(data[&#34;triggerId&#34;])
    job_id = val[&#34;triggers&#34;][trigger_id][&#34;job_id&#34;]
    try:
        if len(val[&#34;triggers&#34;]) == 1:
            val[&#34;triggers&#34;] = [-1]
        else:
            val[&#34;triggers&#34;].pop(trigger_id)
    except:
        return serialize_response(&#39;Invalid trigger id&#39;, {}, 400)
    try:
        scheduler.remove_job(job_id)
        db.child(&#34;Users&#34;).child(user.key()).set(val)
    except:
        return serialize_response(&#39;Invalid trigger id&#39;, {}, 400)
    return serialize_response(&#39;Trigger deleted&#39;, {}, 200)</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<ul class="">
</ul>
</li>
</ul>
</nav>
</main>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
<body>
<main>
<article id="content">
<header>
<h1 class="title"><code>area_tools</code> module</h1>
</header>
<section id="section-intro">
<details class="source">
<summary>Source code</summary>
<pre><code class="python">from flask import make_response, jsonify

def serialize_response(message, data, code):
    &#34;&#34;&#34;
    Description\n
        Tool function to serialize the server reponses
    Parameters
        message : message to send to client\t
        data : data to send to client\t
        code : http response code to send to user\t
    Return
        serialized response
    &#34;&#34;&#34;
    response = {
        &#34;msg&#34;: message,
        &#34;data&#34;: data
    }
    response = jsonify(response)
    return make_response(response, code)

def check_token(authorization, users):
    &#34;&#34;&#34;
    Description\n
        Tool function to check authentication token
    Parameters
        authorization : authorization code\t
        users : database of users
    Return
        auhtenticated user in case of succes, False in case of failure 
    &#34;&#34;&#34;
    if authorization == None or authorization.startswith(&#34;Bearer&#34;) == False:
        return False
    token = authorization.split(&#39; &#39;)[1]
    user = [&#34;tmp&#34;]
    for user_json in users.each():
        if user_json.key() == token:
            user = user_json.val()
            break
    if user == [&#34;tmp&#34;]:
        return False
    return user

def get_user(token, users):
    &#34;&#34;&#34;
    Description\n
       Tool function to get user from a token
    Parameters
        token : authentication token of user\t
        users : database of users
    Return
        authenticated user
    &#34;&#34;&#34;
    user = [&#34;tmp&#34;]
    for user_json in users.each():
        if user_json.key() == token:
            return user_json

def get_trigger_by_jobid(user, jobid):
    &#34;&#34;&#34;
    Description\n
       Tool function to get trigger by jobid
    Parameters
        user : authenticated user\t
        jobid : apscheduler jobid
    Return
        if found, the trigger corresponding to the jobid, false otherwise
    &#34;&#34;&#34;
    i = 0
    for trigger in user[&#34;triggers&#34;]:
        if trigger[&#34;job_id&#34;] == jobid:
            return trigger, i
        i = i + 1
    return False</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="area_tools.check_token"><code class="name flex">
<span>def <span class="ident">check_token</span></span>(<span>authorization, users)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>Tool function to check authentication token</dd>
<dt><strong><code>Parameters</code></strong></dt>
<dd>authorization : authorization code
<br>
users : database of users</dd>
<dt><strong><code>Return</code></strong></dt>
<dd>auhtenticated user in case of succes, False in case of failure</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def check_token(authorization, users):
    &#34;&#34;&#34;
    Description\n
        Tool function to check authentication token
    Parameters
        authorization : authorization code\t
        users : database of users
    Return
        auhtenticated user in case of succes, False in case of failure 
    &#34;&#34;&#34;
    if authorization == None or authorization.startswith(&#34;Bearer&#34;) == False:
        return False
    token = authorization.split(&#39; &#39;)[1]
    user = [&#34;tmp&#34;]
    for user_json in users.each():
        if user_json.key() == token:
            user = user_json.val()
            break
    if user == [&#34;tmp&#34;]:
        return False
    return user</code></pre>
</details>
</dd>
<dt id="area_tools.get_trigger_by_jobid"><code class="name flex">
<span>def <span class="ident">get_trigger_by_jobid</span></span>(<span>user, jobid)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dl>
<dd>Tool function to get trigger by jobid</dd>
<dt><strong><code>Parameters</code></strong></dt>
<dd>user : authenticated user
<br>
jobid : apscheduler jobid</dd>
<dt><strong><code>Return</code></strong></dt>
<dd>if found, the trigger corresponding to the jobid, false otherwise</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def get_trigger_by_jobid(user, jobid):
    &#34;&#34;&#34;
    Description\n
       Tool function to get trigger by jobid
    Parameters
        user : authenticated user\t
        jobid : apscheduler jobid
    Return
        if found, the trigger corresponding to the jobid, false otherwise
    &#34;&#34;&#34;
    i = 0
    for trigger in user[&#34;triggers&#34;]:
        if trigger[&#34;job_id&#34;] == jobid:
            return trigger, i
        i = i + 1
    return False</code></pre>
</details>
</dd>
<dt id="area_tools.get_user"><code class="name flex">
<span>def <span class="ident">get_user</span></span>(<span>token, users)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dl>
<dd>Tool function to get user from a token</dd>
<dt><strong><code>Parameters</code></strong></dt>
<dd>token : authentication token of user
<br>
users : database of users</dd>
<dt><strong><code>Return</code></strong></dt>
<dd>authenticated user</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def get_user(token, users):
    &#34;&#34;&#34;
    Description\n
       Tool function to get user from a token
    Parameters
        token : authentication token of user\t
        users : database of users
    Return
        authenticated user
    &#34;&#34;&#34;
    user = [&#34;tmp&#34;]
    for user_json in users.each():
        if user_json.key() == token:
            return user_json</code></pre>
</details>
</dd>
<dt id="area_tools.serialize_response"><code class="name flex">
<span>def <span class="ident">serialize_response</span></span>(<span>message, data, code)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>Tool function to serialize the server reponses</dd>
<dt><strong><code>Parameters</code></strong></dt>
<dd>message : message to send to client
<br>
data : data to send to client <br>
code : http response code to send to user</dd>
<dt><strong><code>Return</code></strong></dt>
<dd>serialized response</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def serialize_response(message, data, code):
    &#34;&#34;&#34;
    Description\n
        Tool function to serialize the server reponses
    Parameters
        message : message to send to client\t
        data : data to send to client\t
        code : http response code to send to user\t
    Return
        serialized response
    &#34;&#34;&#34;
    response = {
        &#34;msg&#34;: message,
        &#34;data&#34;: data
    }
    response = jsonify(response)
    return make_response(response, code)</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<ul class="">
</ul>
</li>
</ul>
</nav>
</main>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
<body>
<main>
<article id="content">
<header>
<h1 class="title"><code>area_token</code> module</h1>
</header>
<section id="section-intro">
<details class="source">
<summary>Source code</summary>
<pre><code class="python">from flask import Blueprint, request
from area_db import db
from area_tools import serialize_response, check_token

area_token_bp = Blueprint(&#39;area_token_bp&#39;, __name__, template_folder=&#34;templates&#34;)

@area_token_bp.route(&#39;/addTwitterToken&#39;, methods=[&#39;POST&#39;])
def addTwitterToken():
    &#34;&#34;&#34;
    Description\n
        POST route to add a twitter token to an authenticated user
    Json-data
        twitterToken : twitter token from oauth\t
        twitterSecret : twitter secret from oauth
    Headers
        Authorization : Bearer token
    Return
        200 code for succes and 400 for failure
    &#34;&#34;&#34;
    users = db.child(&#39;Users&#39;).get()
    authorization = request.headers.get(&#34;Authorization&#34;)
    token = check_token(authorization, users)
    if token == False:
        return serialize_response(&#39;Unkown user&#39;, {}, 400)
    user = token
    data = request.json
    try:
        twitter_token = data[&#34;twitterToken&#34;]
        twitter_secret = data[&#34;twitterSecret&#34;]
    except:
        return serialize_response(&#39;Missing parameters&#39;, {}, 400)
    user[&#34;tokens&#34;][&#34;twitterToken&#34;] = twitter_token
    user[&#34;tokens&#34;][&#34;twitterSecret&#34;] = twitter_secret
    db.child(&#34;Users&#34;).child(user[&#34;tokens&#34;][&#34;area&#34;]).set(user)
    return serialize_response(&#39;Tokens added&#39;, {}, 200)

@area_token_bp.route(&#39;/addGoogleToken&#39;, methods=[&#39;POST&#39;])
def addGoogleToken():
    &#34;&#34;&#34;
    Description\n
        POST route to add a google token to an authenticated user
    Json-data
        googleToken : google token from oauth\t
        googleId : google id of user
    Headers
        Authorization : Bearer token
    Return
        200 code for succes and 400 for failure
    &#34;&#34;&#34;
    users = db.child(&#39;Users&#39;).get()
    authorization = request.headers.get(&#34;Authorization&#34;)
    token = check_token(authorization, users)
    if token == False:
        return serialize_response(&#39;Unknown user&#39;, {}, 400)
    user = token
    data = request.json
    try:
        google_token = data[&#34;googleToken&#34;]
        google_id = data[&#34;googleId&#34;]
    except:
        return serialize_response(&#39;Missing parameters&#39;, {}, 400)
    user[&#34;tokens&#34;][&#34;googleToken&#34;] = google_token
    user[&#34;tokens&#34;][&#34;googleId&#34;] = google_id
    db.child(&#34;Users&#34;).child(user[&#34;tokens&#34;][&#34;area&#34;]).set(user)
    return serialize_response(&#39;Tokens added&#39;, {}, 200)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="area_token.addGoogleToken"><code class="name flex">
<span>def <span class="ident">addGoogleToken</span></span>(<span>)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>POST route to add a google token to an authenticated user</dd>
<dt><strong><code>Json-data</code></strong></dt>
<dd>googleToken : google token from oauth
<br>
googleId : google id of user</dd>
<dt><strong><code>Headers</code></strong></dt>
<dd>Authorization : Bearer token</dd>
<dt><strong><code>Return</code></strong></dt>
<dd>200 code for succes and 400 for failure</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">@area_token_bp.route(&#39;/addGoogleToken&#39;, methods=[&#39;POST&#39;])
def addGoogleToken():
    &#34;&#34;&#34;
    Description\n
        POST route to add a google token to an authenticated user
    Json-data
        googleToken : google token from oauth\t
        googleId : google id of user
    Headers
        Authorization : Bearer token
    Return
        200 code for succes and 400 for failure
    &#34;&#34;&#34;
    users = db.child(&#39;Users&#39;).get()
    authorization = request.headers.get(&#34;Authorization&#34;)
    token = check_token(authorization, users)
    if token == False:
        return serialize_response(&#39;Unknown user&#39;, {}, 400)
    user = token
    data = request.json
    try:
        google_token = data[&#34;googleToken&#34;]
        google_id = data[&#34;googleId&#34;]
    except:
        return serialize_response(&#39;Missing parameters&#39;, {}, 400)
    user[&#34;tokens&#34;][&#34;googleToken&#34;] = google_token
    user[&#34;tokens&#34;][&#34;googleId&#34;] = google_id
    db.child(&#34;Users&#34;).child(user[&#34;tokens&#34;][&#34;area&#34;]).set(user)
    return serialize_response(&#39;Tokens added&#39;, {}, 200)</code></pre>
</details>
</dd>
<dt id="area_token.addTwitterToken"><code class="name flex">
<span>def <span class="ident">addTwitterToken</span></span>(<span>)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>POST route to add a twitter token to an authenticated user</dd>
<dt><strong><code>Json-data</code></strong></dt>
<dd>twitterToken : twitter token from oauth
<br>
twitterSecret : twitter secret from oauth</dd>
<dt><strong><code>Headers</code></strong></dt>
<dd>Authorization : Bearer token</dd>
<dt><strong><code>Return</code></strong></dt>
<dd>200 code for succes and 400 for failure</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">@area_token_bp.route(&#39;/addTwitterToken&#39;, methods=[&#39;POST&#39;])
def addTwitterToken():
    &#34;&#34;&#34;
    Description\n
        POST route to add a twitter token to an authenticated user
    Json-data
        twitterToken : twitter token from oauth\t
        twitterSecret : twitter secret from oauth
    Headers
        Authorization : Bearer token
    Return
        200 code for succes and 400 for failure
    &#34;&#34;&#34;
    users = db.child(&#39;Users&#39;).get()
    authorization = request.headers.get(&#34;Authorization&#34;)
    token = check_token(authorization, users)
    if token == False:
        return serialize_response(&#39;Unkown user&#39;, {}, 400)
    user = token
    data = request.json
    try:
        twitter_token = data[&#34;twitterToken&#34;]
        twitter_secret = data[&#34;twitterSecret&#34;]
    except:
        return serialize_response(&#39;Missing parameters&#39;, {}, 400)
    user[&#34;tokens&#34;][&#34;twitterToken&#34;] = twitter_token
    user[&#34;tokens&#34;][&#34;twitterSecret&#34;] = twitter_secret
    db.child(&#34;Users&#34;).child(user[&#34;tokens&#34;][&#34;area&#34;]).set(user)
    return serialize_response(&#39;Tokens added&#39;, {}, 200)</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<ul class="">
</ul>
</li>
</ul>
</nav>
</main>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
<body>
<main>
<article id="content">
<header>
<h1 class="title"><code>area_th</code> module</h1>
</header>
<section id="section-intro">
<details class="source">
<summary>Source code</summary>
<pre><code class="python">from area_db import db
from area_tools import get_trigger_by_jobid, get_user
from collections import defaultdict
import requests

client_id = &#39;5mt4b2xhw06al570zsjhdol1tbvoez&#39;
secret_key = &#39;eo9wpgx9v5yyh75h49em99bvug1sv4&#39;

def th_get_status_check(user, th_data):
        &#34;&#34;&#34;
        Description\n
                Check function for th action : th get status
        Parameters
                user : user dict\t
                th_data : th_data dict
        Return
                True or error message
        &#34;&#34;&#34;
        try:
                channel = th_data[&#34;channel&#34;]
        except:
                return &#34;Twitch : Missing channel&#34;
        headers = {
                &#34;Client-ID&#34;: client_id
        }
        url = &#34;https://api.twitch.tv/kraken/channels/&#34; + channel
        r = requests.get(url, headers=headers)
        if r.status_code != 200:
                return &#34;Twitch : Invalid channel name&#34;
        return True

def th_get_status(user, id, reaction, job_id):
        &#34;&#34;&#34;
        Description\n
                Action function for th service : triggers when a chosen streamer goes online
        Parameters
                user : user dict\t
                id : trigger id
                reaction : reaction function\t
                job_id : id of apscheduler job
        Return
                True or error message
        &#34;&#34;&#34;
        channel_name = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;channel&#34;]
        current_user = (get_user(user[&#34;tokens&#34;][&#34;area&#34;], db.child(&#34;Users&#34;).get())).val()
        trigger, trigger_id = get_trigger_by_jobid(current_user, job_id)
        headers = {
                &#34;Client-ID&#34;: client_id
        }
        try:
                channel_id = trigger[&#34;action&#34;][&#34;data&#34;][&#34;channel_id&#34;]
        except:
                url = &#34;https://api.twitch.tv/kraken/channels/&#34; + channel_name
                r = requests.get(url, headers=headers)
                data = r.json()
                channel_id = data[&#34;_id&#34;]
                trigger[&#34;action&#34;][&#34;data&#34;][&#34;channel_id&#34;] = channel_id
                current_user[&#34;triggers&#34;][trigger_id] = trigger
                db.child(&#34;Users&#34;).child(user[&#34;tokens&#34;][&#34;area&#34;]).set(current_user)
        headers[&#34;Accept&#34;] = &#34;application/vnd.twitchtv.v5+json&#34;
        url = &#34;https://api.twitch.tv/kraken/streams/&#34; + str(channel_id)
        r = requests.get(url, headers=headers)
        data = r.json()
        if data[&#34;stream&#34;] != None:
                reaction(user, id)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="area_th.th_get_status"><code class="name flex">
<span>def <span class="ident">th_get_status</span></span>(<span>user, id, reaction, job_id)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>Action function for th service : triggers when a chosen streamer goes online</dd>
<dt><strong><code>Parameters</code></strong></dt>
<dd>user : authenticated user
<br>
id : trigger id
<br>
reaction : reaction function
<br>
job_id : id of apscheduler job</dd>
<dt><strong><code>Return</code></strong></dt>
<dd>True or error message</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def th_get_status(user, id, reaction, job_id):
        &#34;&#34;&#34;
        Description\n
                Action function for th service : triggers when a chosen streamer goes online
        Parameters
                user : user dict\t
                id : trigger id
                reaction : reaction function\t
                job_id : id of apscheduler job
        Return
                True or error message
        &#34;&#34;&#34;
        channel_name = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;channel&#34;]
        current_user = (get_user(user[&#34;tokens&#34;][&#34;area&#34;], db.child(&#34;Users&#34;).get())).val()
        trigger, trigger_id = get_trigger_by_jobid(current_user, job_id)
        headers = {
                &#34;Client-ID&#34;: client_id
        }
        try:
                channel_id = trigger[&#34;action&#34;][&#34;data&#34;][&#34;channel_id&#34;]
        except:
                url = &#34;https://api.twitch.tv/kraken/channels/&#34; + channel_name
                r = requests.get(url, headers=headers)
                data = r.json()
                channel_id = data[&#34;_id&#34;]
                trigger[&#34;action&#34;][&#34;data&#34;][&#34;channel_id&#34;] = channel_id
                current_user[&#34;triggers&#34;][trigger_id] = trigger
                db.child(&#34;Users&#34;).child(user[&#34;tokens&#34;][&#34;area&#34;]).set(current_user)
        headers[&#34;Accept&#34;] = &#34;application/vnd.twitchtv.v5+json&#34;
        url = &#34;https://api.twitch.tv/kraken/streams/&#34; + str(channel_id)
        r = requests.get(url, headers=headers)
        data = r.json()
        if data[&#34;stream&#34;] != None:
                reaction(user, id)</code></pre>
</details>
</dd>
<dt id="area_th.th_get_status_check"><code class="name flex">
<span>def <span class="ident">th_get_status_check</span></span>(<span>user, th_data)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>Check function for th action : th get status</dd>
<dt><strong><code>Parameters</code></strong></dt>
<dd>user : authenticated user
<br>
th_data : th_data dict</dd>
<dt><strong><code>Return</code></strong></dt>
<dd>True or error message</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def th_get_status_check(user, th_data):
        &#34;&#34;&#34;
        Description\n
                Check function for th action : th get status
        Parameters
                user : user dict\t
                th_data : th_data dict
        Return
                True or error message
        &#34;&#34;&#34;
        try:
                channel = th_data[&#34;channel&#34;]
        except:
                return &#34;Twitch : Missing channel&#34;
        headers = {
                &#34;Client-ID&#34;: client_id
        }
        url = &#34;https://api.twitch.tv/kraken/channels/&#34; + channel
        r = requests.get(url, headers=headers)
        if r.status_code != 200:
                return &#34;Twitch : Invalid channel name&#34;
        return True</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<ul class="">
</ul>
</li>
</ul>
</nav>
</main>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
<body>
<main>
<article id="content">
<header>
<h1 class="title"><code>area_lol</code> module</h1>
</header>
<section id="section-intro">
<details class="source">
<summary>Source code</summary>
<pre><code class="python">from flask import Blueprint, render_template, abort, Flask, redirect, url_for, session, request
from area_db import db
from area_tools import check_token, get_user, get_trigger_by_jobid
from bs4 import BeautifulSoup
import requests
import json

def lol_bestof_check(user, lol_data):
        &#34;&#34;&#34;
        Description\n
                Check function for LoL action : lol bestof
        Parameters
                user : user dict\t
                lol_data : lol_data dict
        Return
                True or error message
        &#34;&#34;&#34;
        try:
                summoner = lol_data[&#34;summoner&#34;]
                region = lol_data[&#34;region&#34;]
        except:
                return &#34;LeagueOfLegends : missing summoner name or region&#34;
        url = &#34;https://lolprofile.net/fr/summoner/&#34; + region + &#34;/&#34; + summoner
        response = requests.request(&#34;GET&#34;, url)
        if response.status_code != 200:
                return &#34;LeagueOfLegends : Bad summoner_name or region&#34;
        return True

def lol_bestof(user, id, reaction, job_id):
        &#34;&#34;&#34;
        Description\n
                Action function for LoL service : triggers when a player is in a bestof for a rankup
        Parameters
                user : user dict\t
                id : trigger id\t
                reaction : reaction function\t
                job_id : id of apscheduler job\t
        Return
                True or error message
        &#34;&#34;&#34;
        summoner_name = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;summoner&#34;]
        region_name = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;region&#34;]
        url = &#34;https://lolprofile.net/fr/summoner/&#34; + region_name + &#34;/&#34; + summoner_name
        response = requests.request(&#34;GET&#34;, url)
        page_content = BeautifulSoup(response.content, &#34;html.parser&#34;)
        div_tag = page_content.find(&#34;span&#34;, {&#34;class&#34; : &#34;lp&#34;}).getText()
        current_lp = div_tag.split(&#34;/ &#34;)[1].replace(&#34; LP&#34;, &#34;&#34;)
        if int(current_lp) &gt;= 100:
                reaction(user, id)

def lol_levelup_check(user, lol_data):
        &#34;&#34;&#34;
        Description\n
                Check function for LoL action : lol levelup
        Parameters
                user : user dict\t
                lol_data : lol_data dict
        Return
                True or error message
        &#34;&#34;&#34;
        try:
                summoner = lol_data[&#34;summoner&#34;]
                region = lol_data[&#34;region&#34;]
        except:
                return &#34;LeagueOfLegends : missing summoner name and region&#34;
        url = &#34;https://lolprofile.net/fr/summoner/&#34; + region + &#34;/&#34; + summoner
        response = requests.request(&#34;GET&#34;, url)
        if response.status_code != 200:
                return &#34;LeagueOfLegends : Bad summoner_name or region&#34;
        return True

def lol_levelup(user, id, reaction, job_id):
        &#34;&#34;&#34;
        Description\n
                Action function for LoL service : triggers when a player levels up
        Parameters
                user : user dict\t
                id : trigger id
                reaction : reaction function
                job_id : id of apscheduler job
        Return
                True or error message
        &#34;&#34;&#34;
        summoner_name = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;summoner&#34;]
        region_name = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;region&#34;]
        url = &#34;https://lolprofile.net/fr/summoner/&#34; + region_name + &#34;/&#34; + summoner_name
        response = requests.request(&#34;GET&#34;, url)
        page_content = BeautifulSoup(response.content, &#34;html.parser&#34;)
        div_tag = page_content.find(&#34;div&#34;, {&#34;class&#34; : &#34;s-icon mhide&#34;})
        current_level = div_tag.find(&#34;div&#34;)
        current_level = str(current_level).replace(&#34;&lt;div&gt;Niveau &#34;, &#34;&#34;).replace(&#34;&lt;/div&gt;&#34;, &#34;&#34;)
        current_user = (get_user(user[&#34;tokens&#34;][&#34;area&#34;], db.child(&#34;Users&#34;).get())).val()
        trigger, trigger_id = get_trigger_by_jobid(current_user, job_id)
        try:
                level = trigger[&#34;action&#34;][&#34;data&#34;][&#34;level&#34;]
                if (level != current_level):
                        trigger[&#34;action&#34;][&#34;data&#34;][&#34;level&#34;] = current_level
                        current_user[&#34;triggers&#34;][trigger_id] = trigger
                        db.child(&#34;Users&#34;).child(user[&#34;tokens&#34;][&#34;area&#34;]).set(current_user)
                        reaction(current_user, id)
        except Exception as e:
                print(e)
                trigger[&#34;action&#34;][&#34;data&#34;].update(level = current_level)
                current_user[&#34;triggers&#34;][trigger_id] = trigger
                db.child(&#34;Users&#34;).child(user[&#34;tokens&#34;][&#34;area&#34;]).set(current_user)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="area_lol.lol_bestof"><code class="name flex">
<span>def <span class="ident">lol_bestof</span></span>(<span>user, id, reaction, job_id)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>Action function for LoL service : triggers when a player is in a bestof for a rankup</dd>
<dt><strong><code>Parameters</code></strong></dt>
<dd>user : authenticated user
<br>
id : trigger id
<br>
reaction : reaction function
<br>
job_id : id of apscheduler job</dd>
<dt><strong><code>Return</code></strong></dt>
<dd>True or error message</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def lol_bestof(user, id, reaction, job_id):
        &#34;&#34;&#34;
        Description\n
                Action function for LoL service : triggers when a player is in a bestof for a rankup
        Parameters
                user : user dict\t
                id : trigger id\t
                reaction : reaction function\t
                job_id : id of apscheduler job\t
        Return
                True or error message
        &#34;&#34;&#34;
        summoner_name = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;summoner&#34;]
        region_name = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;region&#34;]
        url = &#34;https://lolprofile.net/fr/summoner/&#34; + region_name + &#34;/&#34; + summoner_name
        response = requests.request(&#34;GET&#34;, url)
        page_content = BeautifulSoup(response.content, &#34;html.parser&#34;)
        div_tag = page_content.find(&#34;span&#34;, {&#34;class&#34; : &#34;lp&#34;}).getText()
        current_lp = div_tag.split(&#34;/ &#34;)[1].replace(&#34; LP&#34;, &#34;&#34;)
        if int(current_lp) &gt;= 100:
                reaction(user, id)</code></pre>
</details>
</dd>
<dt id="area_lol.lol_bestof_check"><code class="name flex">
<span>def <span class="ident">lol_bestof_check</span></span>(<span>user, lol_data)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>Check function for LoL action : lol bestof</dd>
<dt><strong><code>Parameters</code></strong></dt>
<dd>user : authenticated user
<br>
lol_data : lol_data dict</dd>
<dt><strong><code>Return</code></strong></dt>
<dd>True or error message</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def lol_bestof_check(user, lol_data):
        &#34;&#34;&#34;
        Description\n
                Check function for LoL action : lol bestof
        Parameters
                user : user dict\t
                lol_data : lol_data dict
        Return
                True or error message
        &#34;&#34;&#34;
        try:
                summoner = lol_data[&#34;summoner&#34;]
                region = lol_data[&#34;region&#34;]
        except:
                return &#34;LeagueOfLegends : missing summoner name or region&#34;
        url = &#34;https://lolprofile.net/fr/summoner/&#34; + region + &#34;/&#34; + summoner
        response = requests.request(&#34;GET&#34;, url)
        if response.status_code != 200:
                return &#34;LeagueOfLegends : Bad summoner_name or region&#34;
        return True</code></pre>
</details>
</dd>
<dt id="area_lol.lol_levelup"><code class="name flex">
<span>def <span class="ident">lol_levelup</span></span>(<span>user, id, reaction, job_id)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>Action function for LoL service : triggers when a player levels up</dd>
<dt><strong><code>Parameters</code></strong></dt>
<dd>user : authenticated user
<br>
id : trigger id
<br>
reaction : reaction function
<br>
job_id : id of apscheduler job</dd>
<dt><strong><code>Return</code></strong></dt>
<dd>True or error message</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def lol_levelup(user, id, reaction, job_id):
        &#34;&#34;&#34;
        Description\n
                Action function for LoL service : triggers when a player levels up
        Parameters
                user : user dict\t
                id : trigger id
                reaction : reaction function
                job_id : id of apscheduler job
        Return
                True or error message
        &#34;&#34;&#34;
        summoner_name = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;summoner&#34;]
        region_name = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;region&#34;]
        url = &#34;https://lolprofile.net/fr/summoner/&#34; + region_name + &#34;/&#34; + summoner_name
        response = requests.request(&#34;GET&#34;, url)
        page_content = BeautifulSoup(response.content, &#34;html.parser&#34;)
        div_tag = page_content.find(&#34;div&#34;, {&#34;class&#34; : &#34;s-icon mhide&#34;})
        current_level = div_tag.find(&#34;div&#34;)
        current_level = str(current_level).replace(&#34;&lt;div&gt;Niveau &#34;, &#34;&#34;).replace(&#34;&lt;/div&gt;&#34;, &#34;&#34;)
        current_user = (get_user(user[&#34;tokens&#34;][&#34;area&#34;], db.child(&#34;Users&#34;).get())).val()
        trigger, trigger_id = get_trigger_by_jobid(current_user, job_id)
        try:
                level = trigger[&#34;action&#34;][&#34;data&#34;][&#34;level&#34;]
                if (level != current_level):
                        trigger[&#34;action&#34;][&#34;data&#34;][&#34;level&#34;] = current_level
                        current_user[&#34;triggers&#34;][trigger_id] = trigger
                        db.child(&#34;Users&#34;).child(user[&#34;tokens&#34;][&#34;area&#34;]).set(current_user)
                        reaction(current_user, id)
        except Exception as e:
                print(e)
                trigger[&#34;action&#34;][&#34;data&#34;].update(level = current_level)
                current_user[&#34;triggers&#34;][trigger_id] = trigger
                db.child(&#34;Users&#34;).child(user[&#34;tokens&#34;][&#34;area&#34;]).set(current_user)</code></pre>
</details>
</dd>
<dt id="area_lol.lol_levelup_check"><code class="name flex">
<span>def <span class="ident">lol_levelup_check</span></span>(<span>user, lol_data)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>Check function for LoL action : lol levelup</dd>
<dt><strong><code>Parameters</code></strong></dt>
<dd>user : authenticated user
<br>
lol_data : lol_data dict</dd>
<dt><strong><code>Return</code></strong></dt>
<dd>True or error message</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def lol_levelup_check(user, lol_data):
        &#34;&#34;&#34;
        Description\n
                Check function for LoL action : lol levelup
        Parameters
                user : user dict\t
                lol_data : lol_data dict
        Return
                True or error message
        &#34;&#34;&#34;
        try:
                summoner = lol_data[&#34;summoner&#34;]
                region = lol_data[&#34;region&#34;]
        except:
                return &#34;LeagueOfLegends : missing summoner name and region&#34;
        url = &#34;https://lolprofile.net/fr/summoner/&#34; + region + &#34;/&#34; + summoner
        response = requests.request(&#34;GET&#34;, url)
        if response.status_code != 200:
                return &#34;LeagueOfLegends : Bad summoner_name or region&#34;
        return True</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<ul class="">
</ul>
</li>
</ul>
</nav>
</main>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
<body>
<main>
<article id="content">
<header>
<h1 class="title"><code>area_gh</code> module</h1>
</header>
<section id="section-intro">
<details class="source">
<summary>Source code</summary>
<pre><code class="python">from flask import Blueprint, render_template, abort, Flask, redirect, url_for, session, request
from area_db import db
from area_tools import check_token, get_user, get_trigger_by_jobid
import requests
import json

client_id = &#34;d6ee1871e482bf2d6aee&#34;
client_secret = &#34;b727434fae60eb1216eca56fbe0a89bae6bfdc34&#34;

def github_commit_check(user, gh_data):
        &#34;&#34;&#34;
        Description\n
                Check function for GH action : github commit
        Parameters
                user : user dict\t
                gh_data : gh_data dict
        Return
                True or error message
        &#34;&#34;&#34;
        try:
                repo = gh_data[&#34;repo&#34;]
                owner = gh_data[&#34;owner&#34;]
        except:
                return &#34;Github : Missing repository or owner&#34;
        params = [(&#39;client_id&#39;, client_id), (&#39;client_secret&#39;, client_secret)]
        url = &#34;https://api.github.com/repos/&#34; + owner + &#34;/&#34; + repo + &#34;/commits&#34;
        response = requests.request(&#34;GET&#34;, url, params=params)
        if response.status_code != 200:
                return &#34;Github : Bad repository or owner&#34;
        return True

def github_commit(user, id, reaction, job_id):
        &#34;&#34;&#34;
        Description\n
                Action function for GH service : triggers when a commit is made on a chosen repository from a chosen owner
        Parameters
                user : user dict\t
                id : trigger id
                reaction : reaction function\t
                job_id : id of apscheduler job
        &#34;&#34;&#34;
        repo = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;repo&#34;]
        owner = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;owner&#34;]
        params = [(&#39;client_id&#39;, client_id), (&#39;client_secret&#39;, client_secret)]
        url = &#34;https://api.github.com/repos/&#34; + owner + &#34;/&#34; + repo + &#34;/commits&#34;
        response = requests.request(&#34;GET&#34;, url, params=params)
        data = response.json()
        request_commit = data[0][&#34;sha&#34;]
        current_user = (get_user(user[&#34;tokens&#34;][&#34;area&#34;], db.child(&#34;Users&#34;).get())).val()
        trigger, trigger_id = get_trigger_by_jobid(current_user, job_id)
        try:
                last_commit = trigger[&#34;action&#34;][&#34;data&#34;][&#34;last_commit&#34;]
                print (&#34;the sha is &#34; + str(request_commit) + &#34; , last commit is &#34; + str(last_commit))
                if (last_commit != request_commit):
                        trigger[&#34;action&#34;][&#34;data&#34;][&#34;last_commit&#34;] = request_commit
                        current_user[&#34;triggers&#34;][trigger_id] = trigger
                        db.child(&#34;Users&#34;).child(user[&#34;tokens&#34;][&#34;area&#34;]).set(current_user)
                        reaction(current_user, id)
        except Exception as e:
                print(e)
                trigger[&#34;action&#34;][&#34;data&#34;].update(last_commit = request_commit)
                current_user[&#34;triggers&#34;][trigger_id] = trigger
                db.child(&#34;Users&#34;).child(user[&#34;tokens&#34;][&#34;area&#34;]).set(current_user)

def github_stars_check(user, gh_data):
        &#34;&#34;&#34;
        Description\n
                Check function for GH action : github stars
        Parameters
                user : user dict\t
                gh_data : gh_data dict
        Return
                True or error message
        &#34;&#34;&#34;
        try:
                repo = gh_data[&#34;repo&#34;]
                owner = gh_data[&#34;owner&#34;]
                stars = gh_data[&#34;stars&#34;]
        except:
                return &#34;Github : Missing repository name, owner or stars objective&#34;
        params = [(&#39;client_id&#39;, client_id), (&#39;client_secret&#39;, client_secret)]
        url = &#34;https://api.github.com/repos/&#34; + owner + &#34;/&#34; + repo
        response = requests.request(&#34;GET&#34;, url, params=params)
        data = response.json()
        if response.status_code != 200:
                return &#34;Github : Invalid repository name or owner&#34;
        if data[&#34;stargazers_count&#34;] &gt;= int(stars):
                return &#34;Github : Stars objective already reached&#34;
        return True

def github_stars(user, id, reaction, job_id):
        &#34;&#34;&#34;
        Description\n
                Action function for GH service : triggers when a chosen value of stars is hit on a repository
        Parameters
                user : user dict\t
                id : trigger id
                reaction : reaction function\t
                job_id : id of apscheduler job
        &#34;&#34;&#34;
        repo = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;repo&#34;]
        owner = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;owner&#34;]
        stars = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;stars&#34;]
        params = [(&#39;client_id&#39;, client_id), (&#39;client_secret&#39;, client_secret)]
        url = &#34;https://api.github.com/repos/&#34; + owner + &#34;/&#34; + repo
        response = requests.request(&#34;GET&#34;, url, params=params)
        data = response.json()
        if data[&#34;stargazers_count&#34;] &gt;= int(stars):
                reaction(user, id)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="area_gh.github_commit"><code class="name flex">
<span>def <span class="ident">github_commit</span></span>(<span>user, id, reaction, job_id)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>Action function for GH service : triggers when a commit is made on a chosen repository from a chosen owner</dd>
<dt><strong><code>Parameters</code></strong></dt>
<dd>user : authenticated user
<br>
id : trigger id
<br>
reaction : reaction function
<br>
job_id : id of apscheduler job</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def github_commit(user, id, reaction, job_id):
        &#34;&#34;&#34;
        Description\n
                Action function for GH service : triggers when a commit is made on a chosen repository from a chosen owner
        Parameters
                user : user dict\t
                id : trigger id
                reaction : reaction function\t
                job_id : id of apscheduler job
        &#34;&#34;&#34;
        repo = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;repo&#34;]
        owner = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;owner&#34;]
        params = [(&#39;client_id&#39;, client_id), (&#39;client_secret&#39;, client_secret)]
        url = &#34;https://api.github.com/repos/&#34; + owner + &#34;/&#34; + repo + &#34;/commits&#34;
        response = requests.request(&#34;GET&#34;, url, params=params)
        data = response.json()
        request_commit = data[0][&#34;sha&#34;]
        current_user = (get_user(user[&#34;tokens&#34;][&#34;area&#34;], db.child(&#34;Users&#34;).get())).val()
        trigger, trigger_id = get_trigger_by_jobid(current_user, job_id)
        try:
                last_commit = trigger[&#34;action&#34;][&#34;data&#34;][&#34;last_commit&#34;]
                print (&#34;the sha is &#34; + str(request_commit) + &#34; , last commit is &#34; + str(last_commit))
                if (last_commit != request_commit):
                        trigger[&#34;action&#34;][&#34;data&#34;][&#34;last_commit&#34;] = request_commit
                        current_user[&#34;triggers&#34;][trigger_id] = trigger
                        db.child(&#34;Users&#34;).child(user[&#34;tokens&#34;][&#34;area&#34;]).set(current_user)
                        reaction(current_user, id)
        except Exception as e:
                print(e)
                trigger[&#34;action&#34;][&#34;data&#34;].update(last_commit = request_commit)
                current_user[&#34;triggers&#34;][trigger_id] = trigger
                db.child(&#34;Users&#34;).child(user[&#34;tokens&#34;][&#34;area&#34;]).set(current_user)</code></pre>
</details>
</dd>
<dt id="area_gh.github_commit_check"><code class="name flex">
<span>def <span class="ident">github_commit_check</span></span>(<span>user, gh_data)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>Check function for GH action : github commit</dd>
<dt><strong><code>Parameters</code></strong></dt>
<dd>user : authenticated user
<br>
gh_data : gh_data dict</dd>
<dt><strong><code>Return</code></strong></dt>
<dd>True or error message</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def github_commit_check(user, gh_data):
        &#34;&#34;&#34;
        Description\n
                Check function for GH action : github commit
        Parameters
                user : user dict\t
                gh_data : gh_data dict
        Return
                True or error message
        &#34;&#34;&#34;
        try:
                repo = gh_data[&#34;repo&#34;]
                owner = gh_data[&#34;owner&#34;]
        except:
                return &#34;Github : Missing repository or owner&#34;
        params = [(&#39;client_id&#39;, client_id), (&#39;client_secret&#39;, client_secret)]
        url = &#34;https://api.github.com/repos/&#34; + owner + &#34;/&#34; + repo + &#34;/commits&#34;
        response = requests.request(&#34;GET&#34;, url, params=params)
        if response.status_code != 200:
                return &#34;Github : Bad repository or owner&#34;
        return True</code></pre>
</details>
</dd>
<dt id="area_gh.github_stars"><code class="name flex">
<span>def <span class="ident">github_stars</span></span>(<span>user, id, reaction, job_id)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>Action function for GH service : triggers when a chosen value of stars is hit on a repository</dd>
<dt><strong><code>Parameters</code></strong></dt>
<dd>user : authenticated user
<br>
id : trigger id
<br>
reaction : reaction function
<br>
job_id : id of apscheduler job</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def github_stars(user, id, reaction, job_id):
        &#34;&#34;&#34;
        Description\n
                Action function for GH service : triggers when a chosen value of stars is hit on a repository
        Parameters
                user : user dict\t
                id : trigger id
                reaction : reaction function\t
                job_id : id of apscheduler job
        &#34;&#34;&#34;
        repo = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;repo&#34;]
        owner = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;owner&#34;]
        stars = user[&#34;triggers&#34;][id][&#34;action&#34;][&#34;data&#34;][&#34;stars&#34;]
        params = [(&#39;client_id&#39;, client_id), (&#39;client_secret&#39;, client_secret)]
        url = &#34;https://api.github.com/repos/&#34; + owner + &#34;/&#34; + repo
        response = requests.request(&#34;GET&#34;, url, params=params)
        data = response.json()
        if data[&#34;stargazers_count&#34;] &gt;= int(stars):
                reaction(user, id)</code></pre>
</details>
</dd>
<dt id="area_gh.github_stars_check"><code class="name flex">
<span>def <span class="ident">github_stars_check</span></span>(<span>user, gh_data)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>Check function for GH action : github stars</dd>
<dt><strong><code>Parameters</code></strong></dt>
<dd>user : authenticated user
<br>
gh_data : gh_data dict</dd>
<dt><strong><code>Return</code></strong></dt>
<dd>True or error message</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def github_stars_check(user, gh_data):
        &#34;&#34;&#34;
        Description\n
                Check function for GH action : github stars
        Parameters
                user : user dict\t
                gh_data : gh_data dict
        Return
                True or error message
        &#34;&#34;&#34;
        try:
                repo = gh_data[&#34;repo&#34;]
                owner = gh_data[&#34;owner&#34;]
                stars = gh_data[&#34;stars&#34;]
        except:
                return &#34;Github : Missing repository name, owner or stars objective&#34;
        params = [(&#39;client_id&#39;, client_id), (&#39;client_secret&#39;, client_secret)]
        url = &#34;https://api.github.com/repos/&#34; + owner + &#34;/&#34; + repo
        response = requests.request(&#34;GET&#34;, url, params=params)
        data = response.json()
        if response.status_code != 200:
                return &#34;Github : Invalid repository name or owner&#34;
        if data[&#34;stargazers_count&#34;] &gt;= int(stars):
                return &#34;Github : Stars objective already reached&#34;
        return True</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<ul class="">
</ul>
</li>
</ul>
</nav>
</main>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
<body>
<main>
<article id="content">
<header>
<h1 class="title"><code>area_em</code> module</h1>
</header>
<section id="section-intro">
<details class="source">
<summary>Source code</summary>
<pre><code class="python">from flask import Blueprint, render_template, abort, Flask, redirect, url_for, session, request, current_app
from area_db import db
from area_tools import check_token
import requests
import json

def send_mail_check(user, em_data):
        &#34;&#34;&#34;
        Description\n
                Check function for CR reaction : send mail
        Parameters
                user : user dict\t
                em_data : em_data dict
        Return
                True or error message
        &#34;&#34;&#34;
        try:
                recipient = em_data[&#34;recipient&#34;]
                message = em_data[&#34;message&#34;]
        except:
                return False
        return True

def send_mail(user, id):
        &#34;&#34;&#34;
        Description\n
                Reaction function for EM service : sends an email to a chosen recipient
        Parameters
                user : user dict\t
                id : trigger id
        &#34;&#34;&#34;
        recipient = user[&#34;triggers&#34;][id][&#34;reaction&#34;][&#34;data&#34;][&#34;recipient&#34;]
        message = user[&#34;triggers&#34;][id][&#34;reaction&#34;][&#34;data&#34;][&#34;message&#34;]
        url = &#34;http://localhost:8080/sendmail?recipient=&#34; + recipient + &#34;&amp;message=&#34; + message
        response = requests.request(&#34;GET&#34;, url)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="area_em.send_mail"><code class="name flex">
<span>def <span class="ident">send_mail</span></span>(<span>user, id)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>Reaction function for EM service : sends an email to a chosen recipient</dd>
<dt><strong><code>Parameters</code></strong></dt>
<dd>user : authenticated user
<br>
id : trigger id</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def send_mail(user, id):
        &#34;&#34;&#34;
        Description\n
                Reaction function for EM service : sends an email to a chosen recipient
        Parameters
                user : user dict\t
                id : trigger id
        &#34;&#34;&#34;
        recipient = user[&#34;triggers&#34;][id][&#34;reaction&#34;][&#34;data&#34;][&#34;recipient&#34;]
        message = user[&#34;triggers&#34;][id][&#34;reaction&#34;][&#34;data&#34;][&#34;message&#34;]
        url = &#34;http://localhost:8080/sendmail?recipient=&#34; + recipient + &#34;&amp;message=&#34; + message
        response = requests.request(&#34;GET&#34;, url)</code></pre>
</details>
</dd>
<dt id="area_em.send_mail_check"><code class="name flex">
<span>def <span class="ident">send_mail_check</span></span>(<span>user, em_data)</span>
</code></dt>
<dd>
<section class="desc"><dl>
<dt><strong><code>Description</code></strong></dt>
<dd>Check function for CR reaction : send mail</dd>
<dt><strong><code>Parameters</code></strong></dt>
<dd>user : authenticated user
<br>
em_data : em_data dict</dd>
<dt><strong><code>Return</code></strong></dt>
<dd>True or error message</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def send_mail_check(user, em_data):
        &#34;&#34;&#34;
        Description\n
                Check function for CR reaction : send mail
        Parameters
                user : user dict\t
                em_data : em_data dict
        Return
                True or error message
        &#34;&#34;&#34;
        try:
                recipient = em_data[&#34;recipient&#34;]
                message = em_data[&#34;message&#34;]
        except:
                return False
        return True</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<ul class="">
</ul>
</li>
</ul>
</nav>
</main>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.5.3</a>.</p>
</footer>
</body>
</html>